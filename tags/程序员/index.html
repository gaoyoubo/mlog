<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>标签: 程序员 - 雾非雾的情思</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="雾非雾的情思"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="雾非雾的情思"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta property="og:type" content="blog"><meta property="og:title" content="雾非雾的情思"><meta property="og:url" content="http://www.mspring.org/"><meta property="og:site_name" content="雾非雾的情思"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://www.mspring.org/img/og_image.png"><meta property="article:author" content="雾非雾的情思"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://www.mspring.org"},"headline":"雾非雾的情思","image":["http://www.mspring.org/img/og_image.png"],"author":{"@type":"Person","name":"雾非雾的情思"},"description":null}</script><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="雾非雾的情思" type="application/atom+xml">
</head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="http://file.mspring.org/images/blog/avatar.jpg" alt="雾非雾的情思" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">首页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a><a class="navbar-item" href="/links">友链</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Github" href="https://github.com/gaoyoubo"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><div class="card-content"><nav class="breadcrumb" aria-label="breadcrumbs"><ul><li><a href="/tags">标签</a></li><li class="is-active"><a href="#" aria-current="page">程序员</a></li></ul></nav></div></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-03-22T14:04:19.000Z" title="3/22/2021, 2:04:19 PM">2021-03-22</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">1 分钟读完 (大约197个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2021/03/22/MacOS%E5%AE%89%E8%A3%85PHP/">MacOS安装PHP</a></h1><div class="content"><blockquote>
<p>偶然的机会需要用一下PHP，记录下安装方式。本身mac系统是自带php的，但是自带的修改起来及其不方便，不好安装扩展。所以直接使用brew安装。</p>
</blockquote>
<h2 id="brew安装php"><a href="#brew安装php" class="headerlink" title="brew安装php"></a>brew安装php</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew search php  使用此命令搜索可用的PHP版本</span><br><span class="line">brew install php@7.3.21 使用此命令安装指定版本的php</span><br><span class="line">brew install brew-php-switcher 安装php多版本切换工具</span><br><span class="line">brew-php-switcher 7.3.21 切换PHP版本到7.3.21（需要brew安装多个版本）</span><br></pre></td></tr></table></figure>

<h2 id="安装PHP扩展"><a href="#安装PHP扩展" class="headerlink" title="安装PHP扩展"></a>安装PHP扩展</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pecl version 查看版本信息</span><br><span class="line">pecl help 可以查看命令帮助</span><br><span class="line">pecl search redis  搜索可以安装的扩展信息</span><br><span class="line">pecl install redis 安装扩展</span><br><span class="line">pecl install http://pecl.php.net/get/redis-4.2.0.tgz 安装指定版本扩展</span><br></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2020-10-27T16:26:31.000Z" title="10/27/2020, 4:26:31 PM">2020-10-27</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">1 分钟读完 (大约168个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2020/10/27/%E5%9C%A8%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%B8%AD%E5%8E%8B%E7%BC%A9%E5%9B%BE%E7%89%87/">在命令行中压缩图片</a></h1><div class="content"><p>今天有需求将一些非常大的图片压缩一下，本来想自己写代码进行压缩的，但是觉得这是一个非常常见的需求，应该有现成的解决方案，于是Google了一下，找到了这两个工具：jpegoptim、optipng</p>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p><strong>我是在MacOS中安装的，Linux上应该也有这个两个工具，请自行摸索</strong></p>
<p>我使用的是<code>brew</code>进行安装，命令如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install jpegoptim</span><br><span class="line">brew install optipng</span><br></pre></td></tr></table></figure>


<h2 id="jpegoptim-使用"><a href="#jpegoptim-使用" class="headerlink" title="jpegoptim 使用"></a>jpegoptim 使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 压缩</span></span><br><span class="line">jpegoptim file.jpg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指定大小压缩</span></span><br><span class="line">jpegoptim --size=1024k file.jpg</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 移除Exif信息</span></span><br><span class="line">jpegoptim --strip-exif file.jpg</span><br></pre></td></tr></table></figure>

<h2 id="optipng-使用"><a href="#optipng-使用" class="headerlink" title="optipng 使用"></a>optipng 使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optipng file.png</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-11-28T09:42:04.000Z" title="11/28/2019, 9:42:04 AM">2019-11-28</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">2 分钟读完 (大约250个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/11/28/xxx-is-not-in-the-sudoers-file%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">xxx is not in the sudoers file解决方法</a></h1><div class="content"><p>用sudo时提示”xxx is not in the sudoers file. This incident will be reported.其中XXX是你的用户名，也就是你的用户名没有权限使用sudo,我们只要修改一下/etc/sudoers文件就行了。下面是修改方法：</p>
<ol>
<li>进入超级用户模式。也就是输入”su -“,系统会让你输入超级用户密码，输入密码后就进入了超级用户模式。（当然，你也可以直接用root用）</li>
<li>添加文件的写权限。也就是输入命令<code>chmod u+w /etc/sudoers</code>。</li>
<li>编辑/etc/sudoers文件。也就是输入命令<code>vim /etc/sudoers</code>,输入”i”进入编辑模式，找到这一 行：<code>root ALL=(ALL) ALL</code>在起下面添加<code>xxx ALL=(ALL) ALL</code>(这里的xxx是你的用户名)，然后保存（就是先按一 下Esc键，然后输入”:wq”）退出。</li>
<li>撤销文件的写权限。也就是输入命令<code>chmod u-w /etc/sudoers</code>。 </li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-08-02T13:30:52.000Z" title="8/2/2019, 1:30:52 PM">2019-08-02</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">1 分钟读完 (大约204个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/08/02/HexoClient1-3-0%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/">HexoClient1.3.0版本发布</a></h1><div class="content"><h2 id="更新内容"><a href="#更新内容" class="headerlink" title="更新内容"></a>更新内容</h2><ul>
<li>修复阿里云oss图片上传后url不正确的问题。<a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/issues/60">#60</a></li>
<li>支持一键调用<code>hexo generate -d</code>命令发布文章，thanks <a target="_blank" rel="noopener" href="https://github.com/EVINK">EVINK</a><br><img src="http://file.mspring.org/images/blog/FkefJrKFFG3yQp6lumRbJujUgDlr" alt="image.png"></li>
</ul>
<h2 id="功能预览"><a href="#功能预览" class="headerlink" title="功能预览"></a>功能预览</h2><p><img src="http://file.mspring.org/images/blog/FsrXnCJWLcBk3Pfv3uzRI-XaV8FP" alt="image.png"><br><img src="http://file.mspring.org/images/blog/Fiw4MmJIqsSAqst2sAr-DizUD6kd" alt="image.png"></p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li>下载地址：<a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/releases/tag/v1.3.0">https://github.com/gaoyoubo/hexo-client/releases/tag/v1.3.0</a></li>
<li>使用帮助：<a href="https://www.mspring.org/2018/11/29/HexoClient%E4%BD%BF%E7%94%A8%E5%B8%AE%E5%8A%A9/">https://www.mspring.org/2018/11/29/HexoClient%E4%BD%BF%E7%94%A8%E5%B8%AE%E5%8A%A9/</a></li>
<li>提交问题：<a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/issues/new">https://github.com/gaoyoubo/hexo-client/issues/new</a></li>
<li>Github: <a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client">https://github.com/gaoyoubo/hexo-client</a></li>
<li>Gitee: <a target="_blank" rel="noopener" href="https://gitee.com/gaoyoubo/hexo-client">https://gitee.com/gaoyoubo/hexo-client</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-07-15T16:23:19.000Z" title="7/15/2019, 4:23:19 PM">2019-07-15</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">3 分钟读完 (大约504个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/07/15/Golang%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/">Golang并发编程</a></h1><div class="content"><p>Go语言的并发是基于 goroutine 的，goroutine 类似于线程，但并非线程。可以将 goroutine 理解为一种虚拟线程。Go语言运行时会参与调度 goroutine，并将 goroutine 合理地分配到每个 CPU 中，最大限度地使用CPU性能。</p>
<p>Go 程序从 main 包的 main() 函数开始，在程序启动时，Go 程序就会为 main() 函数创建一个默认的 goroutine。</p>
<p><img src="https://i.loli.net/2019/07/15/5d2c2e4fe2f4d88322.jpg"></p>
<p>下面我们来看一个例子，在线演示：<a target="_blank" rel="noopener" href="https://play.golang.org/p/U9U-qjuY0t1">https://play.golang.org/p/U9U-qjuY0t1</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个goroutine</span></span><br><span class="line">	<span class="keyword">go</span> runing()</span><br><span class="line">	<span class="comment">// 创建一个匿名的goroutine</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;喜特:&quot;</span> + time.Now().String())</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里sleep一下是因为main方法如果执行完了，main该程序创建的所有goroutine都会退出</span></span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runing</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;法克:&quot;</span> + time.Now().String())</span><br><span class="line">	time.Sleep(<span class="number">3</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">法克:<span class="number">2009</span><span class="number">-11</span><span class="number">-10</span> <span class="number">23</span>:<span class="number">00</span>:<span class="number">00</span> +<span class="number">0000</span> UTC m=+<span class="number">0.000000001</span></span><br><span class="line">喜特:<span class="number">2009</span><span class="number">-11</span><span class="number">-10</span> <span class="number">23</span>:<span class="number">00</span>:<span class="number">00</span> +<span class="number">0000</span> UTC m=+<span class="number">0.000000001</span></span><br></pre></td></tr></table></figure>

<p>执行结果说明fuck函数中的sleep三秒并没有影响<code>喜特</code>的输出。</p>
<p>如果说 goroutine 是Go语言程序的并发体的话，那么 channel 就是它们之间的通信机制。一个 channel 是一个通信机制，它可以让一个 goroutine 通过它给另一个 goroutine 发送值信息。每个 channel 都有一个特殊的类型，也就是 channel 可发送数据的类型。一个可以发送 int 类型数据的 channel 一般写为 chan int。</p>
<p>下面我们利用goroutine+channel来实现一个生产消费者模型，示例代码如下，在线执行：<a target="_blank" rel="noopener" href="https://play.golang.org/p/lqUBugLdU-I">https://play.golang.org/p/lqUBugLdU-I</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个通道</span></span><br><span class="line">	channel := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int64</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 异步去生产</span></span><br><span class="line">	<span class="keyword">go</span> producer(channel)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 数据消费</span></span><br><span class="line">	consumer(channel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生产者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(channel <span class="keyword">chan</span>&lt;- <span class="keyword">int64</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 将数据写入通道</span></span><br><span class="line">		channel &lt;- time.Now().Unix()</span><br><span class="line">		<span class="comment">// 睡1秒钟</span></span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(channel &lt;-<span class="keyword">chan</span> <span class="keyword">int64</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		timestamp := &lt;-channel</span><br><span class="line">		fmt.Println(timestamp)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出为如下：(每秒钟打印一次)</span><br><span class="line"><span class="number">1257894000</span></span><br><span class="line"><span class="number">1257894001</span></span><br><span class="line"><span class="number">1257894002</span></span><br><span class="line"><span class="number">1257894003</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-07-15T16:22:22.000Z" title="7/15/2019, 4:22:22 PM">2019-07-15</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">2 分钟读完 (大约234个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/07/15/Golang%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E5%92%8C%E5%80%BC%E7%B1%BB%E5%9E%8B/">Golang指针类型和值类型</a></h1><div class="content"><p>Java中值类型和引用类型都是定死的，int、double、float、long、byte、short、char、boolean为值类型，其他的都是引用类型，而Go语言中却不是这样。</p>
<p>在Go语言中：</p>
<ul>
<li><code>&amp;</code>表示取地址，例如你有一个变量<code>a</code>那么<code>&amp;a</code>就是变量<code>a</code>在内存中的地址，对于Golang指针也是有类型的，比如a是一个string那么&amp;a是一个string的指针类型，在Go里面叫&amp;string。</li>
<li><code>*</code>表示取值，接上面的例子，假设你定义<code>b := &amp;a</code> 如果你打印<code>b</code>，那么输出的是<code>&amp;a</code>的内存地址，如果要取值，那么需要使用：<code>*b</code></li>
</ul>
<p>下面我们来看下例子，在线运行：<a target="_blank" rel="noopener" href="https://play.golang.org/p/jxAKyVMjnoy">https://play.golang.org/p/jxAKyVMjnoy</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="string">&quot;123&quot;</span></span><br><span class="line">	b := &amp;a</span><br><span class="line"></span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(*b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">0x40c128</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-07-15T16:20:11.000Z" title="7/15/2019, 4:20:11 PM">2019-07-15</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">13 分钟读完 (大约1908个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/07/15/Java%E7%A8%8B%E5%BA%8F%E5%91%98Go%E8%AF%AD%E8%A8%80%E5%85%A5%E9%97%A8%E7%AE%80%E4%BB%8B/">Java程序员Go语言入门简介</a></h1><div class="content"><h2 id="为什么是Go语言"><a href="#为什么是Go语言" class="headerlink" title="为什么是Go语言"></a>为什么是Go语言</h2><ul>
<li>类C的语法，这意味着Java、C#、JavaScript程序员能很快的上手</li>
<li>有自己的垃圾回收机制</li>
<li>跨平台、编译即可执行无需安装依赖环境</li>
<li>支持反射</li>
</ul>
<h2 id="Go语言简介"><a href="#Go语言简介" class="headerlink" title="Go语言简介"></a>Go语言简介</h2><p>Go 语言（或 Golang）起源于 2007 年，并在 2009 年正式对外发布。Go 是非常年轻的一门语言，它的主要目标是“兼具Python等动态语言的开发速度和 C/C++ 等编译型语言的性能与安全性”。</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><table>
<thead>
<tr>
<th>数据类型</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>bool</td>
<td>布尔</td>
</tr>
<tr>
<td>string</td>
<td>字符串</td>
</tr>
<tr>
<td>int</td>
<td>uint8,uint16,uint32,uint64,int8,int16,int32,int64</td>
</tr>
<tr>
<td>float</td>
<td>float32,float64</td>
</tr>
<tr>
<td>byte</td>
<td>byte</td>
</tr>
</tbody></table>
<p>参考：<a target="_blank" rel="noopener" href="https://www.runoob.com/go/go-data-types.html">https://www.runoob.com/go/go-data-types.html</a></p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><h3 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h3><p>在线运行示例：<a target="_blank" rel="noopener" href="https://play.golang.org/p/-4RylAqUV36">https://play.golang.org/p/-4RylAqUV36</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">  name = <span class="string">&quot;world&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  fmt.Println(<span class="string">&quot;hello &quot;</span> + name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们来执行一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run main.go <span class="comment"># main.go 为刚刚创建的那个文件的名称</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> hello world</span></span><br></pre></td></tr></table></figure>

<h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><h4 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h4><p>在线运行示例：<a target="_blank" rel="noopener" href="https://play.golang.org/p/zPqCkRZgrgp">https://play.golang.org/p/zPqCkRZgrgp</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> name <span class="keyword">string</span>   <span class="comment">// 声明</span></span><br><span class="line">	name = <span class="string">&quot;gaoyoubo&quot;</span> <span class="comment">// 赋值</span></span><br><span class="line">	fmt.Println(name)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> age <span class="keyword">int</span> = <span class="number">18</span> <span class="comment">// 声明并赋值</span></span><br><span class="line">	fmt.Println(age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="类型推断"><a href="#类型推断" class="headerlink" title="类型推断"></a>类型推断</h4><p>在线运行示例：<a target="_blank" rel="noopener" href="https://play.golang.org/p/0My8veBvtJ8">https://play.golang.org/p/0My8veBvtJ8</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	name := <span class="string">&quot;gaoyoubo&quot;</span></span><br><span class="line">	fmt.Println(name)</span><br><span class="line"></span><br><span class="line">	age := <span class="number">18</span></span><br><span class="line">	fmt.Println(age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><ul>
<li>函数可以有多个返回值</li>
<li>隐式的指定函数是private还是public，函数首字母大写的为public、小写的为private</li>
<li>没有类似Java中的<code>try cache</code>、<code>throw</code>，Go语言是通过将<code>error</code>作为返回值来处理异常。</li>
<li>不支持重载</li>
</ul>
<p>下面我们通过一个示例来了解一下，在线运行示例：<a target="_blank" rel="noopener" href="https://play.golang.org/p/PYy3ueuPFS6">https://play.golang.org/p/PYy3ueuPFS6</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	log1()</span><br><span class="line"></span><br><span class="line">	log2(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line"></span><br><span class="line">	ret1 := add1(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;add1 result:&quot;</span> + strconv.Itoa(ret1))</span><br><span class="line"></span><br><span class="line">	ret2, err := Add2(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Add2 result:&quot;</span> + strconv.Itoa(ret2))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;Add2 error&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私有、无入参、无返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">log1</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;execute func log1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私有、入参、无返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">log2</span><span class="params">(msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;execute func log2:&quot;</span> + msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 私有、两个入参、一个返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">add1</span><span class="params">(count1, count2 <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	total := count1 + count2</span><br><span class="line">	fmt.Println(<span class="string">&quot;execute func add3, result=&quot;</span> + strconv.Itoa(total))</span><br><span class="line">	<span class="keyword">return</span> total</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Public、两个入参、多个返回值</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Add2</span><span class="params">(count1, count2 <span class="keyword">int</span>)</span> <span class="params">(<span class="keyword">int</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> count1 &lt; <span class="number">1</span> || count2 &lt; <span class="number">1</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>, errors.New(<span class="string">&quot;数量不能小于1&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	total := count1 + count2</span><br><span class="line">	<span class="keyword">return</span> total, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>该示例输出结果为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">execute func log1</span><br><span class="line">execute func log2:hello world</span><br><span class="line">execute func add3, result&#x3D;2</span><br><span class="line">add1 result:2</span><br><span class="line">Add2 error 数量不能小于1</span><br></pre></td></tr></table></figure>

<p>但函数有多个返回值的时候，有时你只关注其中一个返回值，这种情况下你可以将其他的返回值赋值给空白符：<code>_</code>，如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">_, err := Add2(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">  fmt.Println(err)</span><br><span class="line">&#125;	</span><br></pre></td></tr></table></figure>

<p>空白符特殊在于实际上返回值并没有赋值，所以你可以随意将不同类型的值赋值给他，而不会由于类型不同而报错。</p>
<h3 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h3><p>Go语言不是像Java那样的面向对象的语言，他没有对象和继承的概念。也没有<code>class</code>的概念。在Go语言中有个概念叫做结构体（<code>struct</code>），结构体和Java中的<code>class</code>比较类似。下面我们定义一个结构体：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Gender <span class="keyword">string</span></span><br><span class="line">	Age    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面我们定义了一个结构体<code>User</code>，并为该结构体分别设置了三个公有属性：Name/Gender/Age，下面我们来创建一个User对象。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user := User&#123;</span><br><span class="line">	Name:   <span class="string">&quot;hahaha&quot;</span>,</span><br><span class="line">	Gender: <span class="string">&quot;男&quot;</span>,</span><br><span class="line">	Age:    <span class="number">18</span>, <span class="comment">// 值得一提的是，最后的逗号是必须的，否则编译器会报错，这就是go的设计哲学之一，要求强一致性。</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结构体的属性可以在结构体内直接声明，那么如何为结构体声明函数（即Java中的方法）呢，我们来看下下面的示例：在线运行示例：<a target="_blank" rel="noopener" href="https://play.golang.org/p/01_cTu0RzdH">https://play.golang.org/p/01_cTu0RzdH</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name   <span class="keyword">string</span></span><br><span class="line">	Gender <span class="keyword">string</span></span><br><span class="line">	Age    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义User的成员方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">addAge</span><span class="params">()</span></span> &#123;</span><br><span class="line">	u.Age = u.Age + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	user := User&#123;</span><br><span class="line">		Name:   <span class="string">&quot;哈&quot;</span>, <span class="comment">// 名称</span></span><br><span class="line">		Gender: <span class="string">&quot;男&quot;</span>, <span class="comment">// 性别</span></span><br><span class="line">		Age:    <span class="number">18</span>,  <span class="comment">// 值得一提的是，最后的逗号是必须的，否则编译器会报错，这就是go的设计哲学之一，要求强一致性。</span></span><br><span class="line">	&#125;</span><br><span class="line">	user.addAge()</span><br><span class="line">	fmt.Println(user.Age)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="指针类型和值类型"><a href="#指针类型和值类型" class="headerlink" title="指针类型和值类型"></a>指针类型和值类型</h3><p>Java中值类型和引用类型都是定死的，int、double、float、long、byte、short、char、boolean为值类型，其他的都是引用类型，而Go语言中却不是这样。</p>
<p>在Go语言中：</p>
<ul>
<li><code>&amp;</code>表示取地址，例如你有一个变量<code>a</code>那么<code>&amp;a</code>就是变量<code>a</code>在内存中的地址，对于Golang指针也是有类型的，比如a是一个string那么&amp;a是一个string的指针类型，在Go里面叫&amp;string。</li>
<li><code>*</code>表示取值，接上面的例子，假设你定义<code>b := &amp;a</code> 如果你打印<code>b</code>，那么输出的是<code>&amp;a</code>的内存地址，如果要取值，那么需要使用：<code>*b</code></li>
</ul>
<p>下面我们来看下例子，在线运行：<a target="_blank" rel="noopener" href="https://play.golang.org/p/jxAKyVMjnoy">https://play.golang.org/p/jxAKyVMjnoy</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	a := <span class="string">&quot;123&quot;</span></span><br><span class="line">	b := &amp;a</span><br><span class="line"></span><br><span class="line">	fmt.Println(a)</span><br><span class="line">	fmt.Println(b)</span><br><span class="line">	fmt.Println(*b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出结果为：</span><br><span class="line"><span class="number">123</span></span><br><span class="line"><span class="number">0x40c128</span></span><br><span class="line"><span class="number">123</span></span><br></pre></td></tr></table></figure>

<h3 id="并发编程"><a href="#并发编程" class="headerlink" title="并发编程"></a>并发编程</h3><p>Go语言的并发是基于 goroutine 的，goroutine 类似于线程，但并非线程。可以将 goroutine 理解为一种虚拟线程。Go语言运行时会参与调度 goroutine，并将 goroutine 合理地分配到每个 CPU 中，最大限度地使用CPU性能。</p>
<p>Go 程序从 main 包的 main() 函数开始，在程序启动时，Go 程序就会为 main() 函数创建一个默认的 goroutine。</p>
<p><img src="/images/2019/07/15/55b6ace0-a6d9-11e9-8437-8fc3aa44f6bd.jpg"></p>
<p>下面我们来看一个例子（在线演示：<a target="_blank" rel="noopener" href="https://play.golang.org/p/U9U-qjuY0t1%EF%BC%89">https://play.golang.org/p/U9U-qjuY0t1）</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个goroutine</span></span><br><span class="line">	<span class="keyword">go</span> runing()</span><br><span class="line">	<span class="comment">// 创建一个匿名的goroutine</span></span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;喜特:&quot;</span> + time.Now().String())</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 这里sleep一下是因为main方法如果执行完了，main该程序创建的所有goroutine都会退出</span></span><br><span class="line">	time.Sleep(<span class="number">5</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">runing</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;法克:&quot;</span> + time.Now().String())</span><br><span class="line">	time.Sleep(<span class="number">3</span> * time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">法克:<span class="number">2009</span><span class="number">-11</span><span class="number">-10</span> <span class="number">23</span>:<span class="number">00</span>:<span class="number">00</span> +<span class="number">0000</span> UTC m=+<span class="number">0.000000001</span></span><br><span class="line">喜特:<span class="number">2009</span><span class="number">-11</span><span class="number">-10</span> <span class="number">23</span>:<span class="number">00</span>:<span class="number">00</span> +<span class="number">0000</span> UTC m=+<span class="number">0.000000001</span></span><br></pre></td></tr></table></figure>

<p>执行结果说明fuck函数中的sleep三秒并没有影响<code>喜特</code>的输出。</p>
<p>如果说 goroutine 是Go语言程序的并发体的话，那么 channel 就是它们之间的通信机制。一个 channel 是一个通信机制，它可以让一个 goroutine 通过它给另一个 goroutine 发送值信息。每个 channel 都有一个特殊的类型，也就是 channel 可发送数据的类型。一个可以发送 int 类型数据的 channel 一般写为 chan int。</p>
<p>下面我们利用goroutine+channel来实现一个生产消费者模型，示例代码如下：（在线执行：<a target="_blank" rel="noopener" href="https://play.golang.org/p/lqUBugLdU-I%EF%BC%89">https://play.golang.org/p/lqUBugLdU-I）</a></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// 创建一个通道</span></span><br><span class="line">	channel := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int64</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 异步去生产</span></span><br><span class="line">	<span class="keyword">go</span> producer(channel)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 数据消费</span></span><br><span class="line">	consumer(channel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 生产者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">producer</span><span class="params">(channel <span class="keyword">chan</span>&lt;- <span class="keyword">int64</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		<span class="comment">// 将数据写入通道</span></span><br><span class="line">		channel &lt;- time.Now().Unix()</span><br><span class="line">		<span class="comment">// 睡1秒钟</span></span><br><span class="line">		time.Sleep(time.Second)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">consumer</span><span class="params">(channel &lt;-<span class="keyword">chan</span> <span class="keyword">int64</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">		timestamp := &lt;-channel</span><br><span class="line">		fmt.Println(timestamp)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出为如下：(每秒钟打印一次)</span><br><span class="line"><span class="number">1257894000</span></span><br><span class="line"><span class="number">1257894001</span></span><br><span class="line"><span class="number">1257894002</span></span><br><span class="line"><span class="number">1257894003</span></span><br></pre></td></tr></table></figure>


<h2 id="Java程序员觉得不好用的地方"><a href="#Java程序员觉得不好用的地方" class="headerlink" title="Java程序员觉得不好用的地方"></a>Java程序员觉得不好用的地方</h2><ul>
<li>异常处理</li>
<li>没有泛型</li>
<li>不支持多态、重载</li>
<li>不支持注解（但是他的struct中的属性支持<code>tag</code>）</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.runoob.com/go/go-tutorial.html">https://www.runoob.com/go/go-tutorial.html</a></li>
<li><a target="_blank" rel="noopener" href="https://books.studygolang.com/the-little-go-book_ZH_CN/">https://books.studygolang.com/the-little-go-book_ZH_CN/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-04-28T18:04:24.000Z" title="4/28/2019, 6:04:24 PM">2019-04-28</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">3 分钟读完 (大约474个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/04/28/markdown-help/">Markdown 语法指南</a></h1><div class="content"><h1 id="Markdown-语法指南"><a href="#Markdown-语法指南" class="headerlink" title="Markdown 语法指南"></a>Markdown 语法指南</h1><blockquote>
<p><a target="_blank" rel="noopener" href="http://commonmark.org/help/">语法详解</a></p>
</blockquote>
<h2 id="粗体"><a href="#粗体" class="headerlink" title="粗体"></a><strong>粗体</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">**粗体**</span><br><span class="line">__粗体__</span><br></pre></td></tr></table></figure>
<h2 id="斜体"><a href="#斜体" class="headerlink" title="斜体"></a><em>斜体</em></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">*斜体*</span><br><span class="line">_斜体_</span><br></pre></td></tr></table></figure>
<h2 id="标题"><a href="#标题" class="headerlink" title="标题"></a>标题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 一级标题 #</span><br><span class="line">一级标题</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">## 二级标题 ##</span><br><span class="line">二级标题</span><br><span class="line">----</span><br><span class="line">### 三级标题 ###</span><br><span class="line">#### 四级标题 ####</span><br><span class="line">##### 五级标题 #####</span><br><span class="line">###### 六级标题 ######</span><br></pre></td></tr></table></figure>
<h2 id="分割线"><a href="#分割线" class="headerlink" title="分割线"></a>分割线</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">***</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="上-角下标"><a href="#上-角下标" class="headerlink" title="^上^角下标"></a>^上^角<del>下</del>标</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">上角标 x^2^</span><br><span class="line">下角标 H~2~0</span><br></pre></td></tr></table></figure>
<h2 id="下划线-中划线"><a href="#下划线-中划线" class="headerlink" title="++下划线++ 中划线"></a>++下划线++ <del>中划线</del></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">++下划线++</span><br><span class="line">~~中划线~~</span><br></pre></td></tr></table></figure>
<h2 id="标记"><a href="#标记" class="headerlink" title="==标记=="></a>==标记==</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x3D;&#x3D;标记&#x3D;&#x3D;</span><br></pre></td></tr></table></figure>
<h2 id="段落引用"><a href="#段落引用" class="headerlink" title="段落引用"></a>段落引用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt; 一级</span><br><span class="line">&gt;&gt; 二级</span><br><span class="line">&gt;&gt;&gt; 三级</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">有序列表</span><br><span class="line">1.</span><br><span class="line">2.</span><br><span class="line">3.</span><br><span class="line">...</span><br><span class="line">无序列表</span><br><span class="line">-</span><br><span class="line">-</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h2 id="任务列表"><a href="#任务列表" class="headerlink" title="任务列表"></a>任务列表</h2><ul>
<li><input checked="" disabled="" type="checkbox"> 已完成任务</li>
<li><input disabled="" type="checkbox"> 未完成任务</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- [x] 已完成任务</span><br><span class="line">- [ ] 未完成任务</span><br></pre></td></tr></table></figure>

<h2 id="链接"><a href="#链接" class="headerlink" title="链接"></a>链接</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[链接](www.baidu.com)</span><br><span class="line">![图片描述](http:&#x2F;&#x2F;www.image.com)</span><br></pre></td></tr></table></figure>
<h2 id="代码段落"><a href="#代码段落" class="headerlink" title="代码段落"></a>代码段落</h2><p>``` type</p>
<p>代码段落</p>
<p>```</p>
<p>` 代码块 `</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;hello world!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>code</code></p>
<h2 id="表格-table"><a href="#表格-table" class="headerlink" title="表格(table)"></a>表格(table)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">| 标题1 | 标题2 | 标题3 |</span><br><span class="line">| :--  | :--: | ----: |</span><br><span class="line">| 左对齐 | 居中 | 右对齐 |</span><br><span class="line">| ---------------------- | ------------- | ----------------- |</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th align="left">标题1</th>
<th align="center">标题2</th>
<th align="right">标题3</th>
</tr>
</thead>
<tbody><tr>
<td align="left">左对齐</td>
<td align="center">居中</td>
<td align="right">右对齐</td>
</tr>
<tr>
<td align="left">———————-</td>
<td align="center">————-</td>
<td align="right">—————–</td>
</tr>
</tbody></table>
<h2 id="脚注-footnote"><a href="#脚注-footnote" class="headerlink" title="脚注(footnote)"></a>脚注(footnote)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello[^hello]</span><br></pre></td></tr></table></figure>

<p>见底部脚注<a href="%E4%B8%80%E4%B8%AA%E6%B3%A8%E8%84%9A">^hello</a></p>
<h2 id="表情-emoji"><a href="#表情-emoji" class="headerlink" title="表情(emoji)"></a>表情(emoji)</h2><p><a target="_blank" rel="noopener" href="https://www.webpagefx.com/tools/emoji-cheat-sheet/">参考网站: https://www.webpagefx.com/tools/emoji-cheat-sheet/</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">:laughing:</span><br><span class="line">:blush:</span><br><span class="line">:smiley:</span><br><span class="line">:)</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>:laughing::blush::smiley::)</p>
<h2 id="KaTeX-公式"><a href="#KaTeX-公式" class="headerlink" title="$\KaTeX$公式"></a>$\KaTeX$公式</h2><p>我们可以渲染公式例如：$x_i + y_i = z_i$和$\sum_{i=1}^n a_i=0$<br>我们也可以单行渲染<br>$$\sum_{i=1}^n a_i=0$$<br>具体可参照<a target="_blank" rel="noopener" href="http://www.intmath.com/cg5/katex-mathjax-comparison.php">katex文档</a>和<a target="_blank" rel="noopener" href="https://github.com/Khan/KaTeX/wiki/Function-Support-in-KaTeX">katex支持的函数</a>以及<a target="_blank" rel="noopener" href="https://math.meta.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference">latex文档</a></p>
<h2 id="布局"><a href="#布局" class="headerlink" title="布局"></a>布局</h2><p>::: hljs-left<br><code>::: hljs-left</code><br><code>居左</code><br><code>:::</code><br>:::</p>
<p>::: hljs-center<br><code>::: hljs-center</code><br><code>居中</code><br><code>:::</code><br>:::</p>
<p>::: hljs-right<br><code>::: hljs-right</code><br><code>居右</code><br><code>:::</code><br>:::</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><p>术语一</p>
<p>:   定义一</p>
<p>包含有<em>行内标记</em>的术语二</p>
<p>:   定义二</p>
<pre><code>    &#123;一些定义二的文字或代码&#125;

定义二的第三段
</code></pre>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">术语一</span><br><span class="line"></span><br><span class="line">:   定义一</span><br><span class="line"></span><br><span class="line">包含有*行内标记*的术语二</span><br><span class="line"></span><br><span class="line">:   定义二</span><br><span class="line"></span><br><span class="line">        &#123;一些定义二的文字或代码&#125;</span><br><span class="line"></span><br><span class="line">    定义二的第三段</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="abbr"><a href="#abbr" class="headerlink" title="abbr"></a>abbr</h2><p>*[HTML]: Hyper Text Markup Language<br>*[W3C]:  World Wide Web Consortium<br>HTML 规范由 W3C 维护</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">*[HTML]: Hyper Text Markup Language</span><br><span class="line">*[W3C]:  World Wide Web Consortium</span><br><span class="line">HTML 规范由 W3C 维护</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-04-23T13:34:10.000Z" title="4/23/2019, 1:34:10 PM">2019-04-23</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约34个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/04/23/%E8%A7%A3%E5%86%B3%E9%85%8D%E7%BD%AEauthorized-keys%E6%97%A0%E6%B3%95%E7%99%BB%E9%99%86/">解决配置authorized_keys无法登陆</a></h1><div class="content"><p>因为权限问题才无法登陆，这里记录下，方便后面查用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo chmod 644 ~/.ssh/authorized_keys</span><br><span class="line">sudo chmod 700 ~/.ssh</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-03-18T19:00:26.000Z" title="3/18/2019, 7:00:26 PM">2019-03-18</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">4 分钟读完 (大约615个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/03/18/Golang-transaction-%E4%BA%8B%E5%8A%A1%E4%BD%BF%E7%94%A8%E7%9A%84%E6%AD%A3%E7%A1%AE%E5%A7%BF%E5%8A%BF/">Golang transaction 事务使用的正确姿势</a></h1><div class="content"><h2 id="第一种写法"><a href="#第一种写法" class="headerlink" title="第一种写法"></a>第一种写法</h2><p>这种写法非常朴实，程序流程也非常明确，但是事务处理与程序流程嵌入太深，容易遗漏，造成严重的问题</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    tx, err := db.Begin()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> &#123;</span><br><span class="line">            tx.Rollback()</span><br><span class="line">            <span class="built_in">panic</span>(p)  <span class="comment">// re-throw panic after Rollback</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        tx.Rollback()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        tx.Rollback()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    err = tx.Commit()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第二种写法"><a href="#第二种写法" class="headerlink" title="第二种写法"></a>第二种写法</h2><p>下面这种写法把事务处理从程序流程抽离了出来，不容易遗漏，但是作用域是整个函数，程序流程不是很清晰</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    tx, err := db.Begin()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> &#123;</span><br><span class="line">            tx.Rollback()</span><br><span class="line">            <span class="built_in">panic</span>(p) <span class="comment">// re-throw panic after Rollback</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            tx.Rollback()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            err = tx.Commit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="第三种写法"><a href="#第三种写法" class="headerlink" title="第三种写法"></a>第三种写法</h2><p>写法三是对写法二的进一步封装，写法高级一点，缺点同上</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Transact</span><span class="params">(db *sql.DB, txFunc <span class="keyword">func</span>(*sql.Tx)</span> <span class="title">error</span>) <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    tx, err := db.Begin()</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> p := <span class="built_in">recover</span>(); p != <span class="literal">nil</span> &#123;</span><br><span class="line">            tx.Rollback()</span><br><span class="line">            <span class="built_in">panic</span>(p) <span class="comment">// re-throw panic after Rollback</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            tx.Rollback()</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            err = tx.Commit()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    err = txFunc(tx)</span><br><span class="line">    <span class="keyword">return</span> err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Transact(db, <span class="function"><span class="keyword">func</span> <span class="params">(tx *sql.Tx)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">        <span class="keyword">if</span> _, err := tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> _, err := tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> err</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="我的写法"><a href="#我的写法" class="headerlink" title="我的写法"></a>我的写法</h2><p>经过总结和实验，我采用了下面这种写法，defer tx.Rollback() 使得事务回滚始终得到执行。 当 tx.Commit() 执行后，tx.Rollback() 起到关闭事务的作用， 当程序因为某个错误中止，tx.Rollback() 起到回滚事务，同事关闭事务的作用。</p>
<h3 id="普通场景"><a href="#普通场景" class="headerlink" title="普通场景"></a>普通场景</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">  tx, _ := db.Begin()</span><br><span class="line">  <span class="keyword">defer</span> tx.Rollback()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  err = tx.Commit()</span><br><span class="line">  <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="循环场景"><a href="#循环场景" class="headerlink" title="循环场景"></a>循环场景</h3><p>(1) 小事务 每次循环提交一次 在循环内部使用这种写法的时候，defer 不能使用，所以要把事务部分抽离到独立的函数当中</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    tx, _ := db.Begin()</span><br><span class="line">    <span class="keyword">defer</span> tx.Rollback()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    err = tx.Commit()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := DoSomething(); err != <span class="literal">nil</span>&#123;</span><br><span class="line">         <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>(2) 大事务 批量提交 大事务的场景和普通场景是一样的，没有任何区别</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DoSomething</span><span class="params">()</span> <span class="params">(err error)</span></span> &#123;</span><br><span class="line">    tx, _ := db.Begin()</span><br><span class="line">    <span class="keyword">defer</span> tx.Rollback()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> _, err = tx.Exec(...); err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    err = tx.Commit()</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>参考链接:<br><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/16184238/database-sql-tx-detecting-commit-or-rollback">https://stackoverflow.com/questions/16184238/database-sql-tx-detecting-commit-or-rollback</a><br>原文地址：<br><a target="_blank" rel="noopener" href="http://hopehook.com/2017/08/21/golang_transaction/">http://hopehook.com/2017/08/21/golang_transaction/</a></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-03-15T11:11:16.000Z" title="3/15/2019, 11:11:16 AM">2019-03-15</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">1 分钟读完 (大约189个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/03/15/HexoClient1-2-6%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/">HexoClient1.2.6版本发布</a></h1><div class="content"><h2 id="本次更新内容"><a href="#本次更新内容" class="headerlink" title="本次更新内容"></a>本次更新内容</h2><ul>
<li>feature：支持hexo特性<code>front-matter</code> <a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/issues/32">#32</a> <a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/issues/38">#38</a></li>
<li>bugfix：修复一处RCE(任意代码执行)漏洞 <a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/issues/35">#35</a></li>
<li>升级<code>electron</code> 到最新版本</li>
<li>升级<code>webpack</code>到最新版本，解决老版本漏洞问题</li>
</ul>
<h2 id="功能预览"><a href="#功能预览" class="headerlink" title="功能预览"></a>功能预览</h2><p><img src="/images/2019/03/15/11117750-46d0-11e9-8878-0bcbaac2a347.png" alt="image.png"><br><img src="/images/2019/03/15/5fde8030-46d0-11e9-8878-0bcbaac2a347.png" alt="image.png"></p>
<h2 id="相关链接"><a href="#相关链接" class="headerlink" title="相关链接"></a>相关链接</h2><ul>
<li>Github: <a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client">https://github.com/gaoyoubo/hexo-client</a></li>
<li>Gitee: <a target="_blank" rel="noopener" href="https://gitee.com/gaoyoubo/hexo-client">https://gitee.com/gaoyoubo/hexo-client</a></li>
<li>下载地址：<a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.6">https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.6</a></li>
<li>使用帮助：<a href="https://www.mspring.org/tags/HexoClient/">https://www.mspring.org/tags/HexoClient/</a></li>
<li>提交问题：<a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/issues/new">https://github.com/gaoyoubo/hexo-client/issues/new</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-03-15T10:56:22.000Z" title="3/15/2019, 10:56:22 AM">2019-03-15</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">4 分钟读完 (大约636个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/03/15/go-mod-%E7%9A%84%E4%BD%BF%E7%94%A8/">go mod 的使用</a></h1><div class="content"><p>从Go1.11开始，golang官方支持了新的依赖管理工具<code>go mod</code>。</p>
<h2 id="命令行说明"><a href="#命令行说明" class="headerlink" title="命令行说明"></a>命令行说明</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ go mod</span><br><span class="line">Go mod provides access to operations on modules.</span><br><span class="line"></span><br><span class="line">Note that support for modules is built into all the go commands,</span><br><span class="line">not just &#x27;go mod&#x27;. For example, day-to-day adding, removing, upgrading,</span><br><span class="line">and downgrading of dependencies should be done using &#x27;go get&#x27;.</span><br><span class="line">See &#x27;go help modules&#x27; for an overview of module functionality.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line"></span><br><span class="line">	go mod &lt;command&gt; [arguments]</span><br><span class="line"></span><br><span class="line">The commands are:</span><br><span class="line"></span><br><span class="line">	download    download modules to local cache</span><br><span class="line">	edit        edit go.mod from tools or scripts</span><br><span class="line">	graph       print module requirement graph</span><br><span class="line">	init        initialize new module in current directory</span><br><span class="line">	tidy        add missing and remove unused modules</span><br><span class="line">	vendor      make vendored copy of dependencies</span><br><span class="line">	verify      verify dependencies have expected content</span><br><span class="line">	why         explain why packages or modules are needed</span><br><span class="line"></span><br><span class="line">Use &quot;go help mod &lt;command&gt;&quot; for more information about a command.</span><br></pre></td></tr></table></figure>
<ul>
<li>go mod download: 下载依赖的module到本地cache</li>
<li>go mod edit: 编辑go.mod</li>
<li>go mod graph: 打印模块依赖图</li>
<li>go mod init: 在当前目录下初始化go.mod(就是会新建一个go.mod文件)</li>
<li>go mod tidy: 整理依赖关系，会添加丢失的module，删除不需要的module</li>
<li>go mod vender: 将依赖复制到vendor下</li>
<li>go mod verify: 校验依赖</li>
<li>go mod why: 解释为什么需要依赖</li>
</ul>
<h2 id="在新项目中使用"><a href="#在新项目中使用" class="headerlink" title="在新项目中使用"></a>在新项目中使用</h2><p>使用go mod并不要求你的项目源码放到$GOPATH下，所以你的新项目可以放到任意你喜欢的路径。在项目根目录下执行<code>go mod init</code>，会生成一个go.mod文件。然后你可以在其中增加你的依赖，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">module github.com&#x2F;gaoyoubo&#x2F;xxx</span><br><span class="line"></span><br><span class="line">go 1.12</span><br><span class="line"></span><br><span class="line">require (</span><br><span class="line">	github.com&#x2F;go-sql-driver&#x2F;mysql v1.4.1</span><br><span class="line">        .... 你的依赖类似这样，添加到这里，一行一条。</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>然后执行<code>go mod download</code>，将依赖下载到本地。这些依赖并不是下载到你的项目目录下，而是会下载到<code>$GOPATH/pkg/mod</code>目录下，这样所有使用go mod的项目都可以共用。</p>
<h2 id="在旧项目中使用"><a href="#在旧项目中使用" class="headerlink" title="在旧项目中使用"></a>在旧项目中使用</h2><p>在旧项目中使用非常简单，只需要一下两个步骤：</p>
<ul>
<li><code>go mod init</code>: 在项目根目录下执行该命令，会在项目根目录下生成一个<code>go.mod</code>文件。</li>
<li><code>go mod tidy</code>: 在项目根目录下执行该命令，go mod会自动分析你当前项目所需要的依赖，并且将他们下载下来。</li>
</ul>
<h2 id="如何升级依赖"><a href="#如何升级依赖" class="headerlink" title="如何升级依赖"></a>如何升级依赖</h2><p>运行 <code>go get -u</code> 将会升级到最新的次要版本或者修订版本(x.y.z, z是修订版本号y是次要版本号)<br>运行 <code>go get -u=patch</code> 将会升级到最新的修订版本<br>运行 <code>go get package@version</code> 将会升级到指定的版本</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-03-11T14:28:19.000Z" title="3/11/2019, 2:28:19 PM">2019-03-11</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">3 分钟读完 (大约397个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/03/11/mysql5-x%E9%87%8D%E7%BD%AE%E5%AF%86%E7%A0%81/">mysql5.x重置密码</a></h1><div class="content"><p>This one is for all MySQL-DBA’s, which are working on macOS. Since the Apple OS has a rather peculiar way of starting and stopping MySQL, compared to Linux, you can run into some issues. These problems occur especially, if you have no access to the GUI.</p>
<h2 id="PREPARATION"><a href="#PREPARATION" class="headerlink" title="PREPARATION"></a>PREPARATION</h2><p>Put skip-grant-tables into the mysqld section of the my.cnf. A my.cnf can be found in /usr/local/mysql/support-files. You MUST work as root for all the following steps.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> sudo -s</span></span><br><span class="line"><span class="meta">shell&gt;</span><span class="bash"> vi /usr/<span class="built_in">local</span>/mysql/support-files/my-default.cnf</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">[mysqld]</span><br><span class="line">skip-grant-tables</span><br><span class="line">skip-networking</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>Save the configuration file! (In vi this is “[ESC] + :x”)</p>
<p>Continue with stopping MySQL:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl unload /Library/LaunchDaemons/com.oracle.oss.mysql.mysqld.plist</span><br></pre></td></tr></table></figure>
<p>Restart MySQL, so skip-grant-tables becomes active:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl load /Library/LaunchDaemons/com.oracle.oss.mysql.mysqld.plist</span><br></pre></td></tr></table></figure>

<h2 id="RESET-THE-PASSWORD"><a href="#RESET-THE-PASSWORD" class="headerlink" title="RESET THE PASSWORD"></a>RESET THE PASSWORD</h2><p>After MySQL is started again, you can log into the CLI and reset the password:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> mysql -u root</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> FLUSH PRIVILEGES;</span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> ALTER USER <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span> IDENTIFIED BY <span class="string">&#x27;super-secret-password&#x27;</span>;</span></span><br></pre></td></tr></table></figure>

<h2 id="PLAN-B"><a href="#PLAN-B" class="headerlink" title="PLAN B"></a>PLAN B</h2><p>If you are not capable of stopping MySQL in a civilised manner, you can use the more rough way. You can send a SIGTERM to the MySQL-Server:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> ps -aef | grep mysql | grep -v grep</span></span><br><span class="line">   74 28017     1   0 Fri10AM ??         5:59.50 /usr/local/mysql/bin/mysqld --user=_mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data --plugin-dir=/usr/local/mysql/lib/plugin --log-error=/usr/local/mysql/data/mysqld.local.err --pid-file=/usr/local/mysql/data/mysqld.local.pid</span><br></pre></td></tr></table></figure>
<p>You should receive one line. The second column from the left is the process id. Use this process id to stop the MySQL-Server.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">kill</span> -15 [process id]</span></span><br></pre></td></tr></table></figure>
<p>In this example, the command would look like this:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">shell&gt;</span><span class="bash"> <span class="built_in">kill</span> -15 28017</span></span><br></pre></td></tr></table></figure>
<p>macOS will restart MySQL, since the process has not stopped correctly. The configuration will be read and the changes to the parameters will become effective. Continue with logging in to the CLI.</p>
<h2 id="CONCLUSION"><a href="#CONCLUSION" class="headerlink" title="CONCLUSION"></a>CONCLUSION</h2><p>No matter how secure your MySQL-Password is, it is a lot more important to secure access to the server it self. If your server is not secured by something that prevents access from the internet, it will only take a few minutes for someone with bad intentions to take over your database or worse, the entire server.</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-03-11T10:45:07.000Z" title="3/11/2019, 10:45:07 AM">2019-03-11</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">4 分钟读完 (大约540个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/03/11/Golang%E5%92%8CJava%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E8%B0%83%E6%9F%A5/">Golang和Java构建工具调查</a></h1><div class="content"><p>Github：<a target="_blank" rel="noopener" href="https://github.com/blindpirate/report-of-build-tools-for-java-and-golang">https://github.com/blindpirate/report-of-build-tools-for-java-and-golang</a></p>
<h1 id="A-Survey-on-Build-Tools-of-Golang-and-Java"><a href="#A-Survey-on-Build-Tools-of-Golang-and-Java" class="headerlink" title="A Survey on Build Tools of Golang and Java"></a>A Survey on Build Tools of Golang and Java</h1><h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>In January 2017, the usage of build tools in <a target="_blank" rel="noopener" href="http://github-rank.com/star?language=Java">Github’s top 1000 Java repositories</a> is as follows:</p>
<table>
<thead>
<tr>
<th>Tool Name</th>
<th align="center">Reference Count</th>
</tr>
</thead>
<tbody><tr>
<td>Gradle</td>
<td align="center">627</td>
</tr>
<tr>
<td>Maven</td>
<td align="center">264</td>
</tr>
<tr>
<td>Ant</td>
<td align="center">52</td>
</tr>
<tr>
<td>Npm</td>
<td align="center">4</td>
</tr>
<tr>
<td>Bazel</td>
<td align="center">3</td>
</tr>
<tr>
<td>Make</td>
<td align="center">1</td>
</tr>
</tbody></table>
<p>And the trending over the past 8 years is:</p>
<p><img src="/images/2019/03/11/c6a8a010-43a7-11e9-a68f-4fc47d059a0e.png" alt="trending"></p>
<h2 id="Algorithm"><a href="#Algorithm" class="headerlink" title="Algorithm"></a>Algorithm</h2><ul>
<li>Clone top 1000 Java repositories to local disk</li>
<li>Analyze the repositories by identity files:</li>
</ul>
<table>
<thead>
<tr>
<th>Tool Name</th>
<th align="center">Identity Files</th>
</tr>
</thead>
<tbody><tr>
<td>Gradle</td>
<td align="center">build.gradle</td>
</tr>
<tr>
<td>Maven</td>
<td align="center">pom.xml</td>
</tr>
<tr>
<td>Ant</td>
<td align="center">build.xml</td>
</tr>
<tr>
<td>Npm</td>
<td align="center">package.json</td>
</tr>
<tr>
<td>Bazel</td>
<td align="center">BUILD</td>
</tr>
<tr>
<td>Make</td>
<td align="center">Makefile/makefile</td>
</tr>
</tbody></table>
<h2 id="How"><a href="#How" class="headerlink" title="How"></a>How</h2><ul>
<li>Make sure <a target="_blank" rel="noopener" href="https://git-scm.com/">Git</a>/<a target="_blank" rel="noopener" href="http://www.groovy-lang.org/download.html">Groovy 2.4+</a>/<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">JDK 1.7+</a> are installed.</li>
<li>Run <code>groovy GithubTopRankCrawler.groovy -l java -d &lt;path to store the 1000 repos&gt;</code> to clone all repositories locally. </li>
<li>Run <code>groovy JavaBuildToolScanner.groovy -d &lt;path to store the 1000 repos&gt;</code> to analyze these repos.</li>
</ul>
<h1 id="Golang"><a href="#Golang" class="headerlink" title="Golang"></a>Golang</h1><h2 id="Conclusion-1"><a href="#Conclusion-1" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>There are various package management tools for golang as listed <a target="_blank" rel="noopener" href="https://github.com/golang/go/wiki/PackageManagementTools">here</a>. But which one is the most popular? </p>
<p>The usage of package manage tools in <a target="_blank" rel="noopener" href="http://github-rank.com/star?language=Go">Github’s top 1000 Go repositories</a> is as follows:</p>
<table>
<thead>
<tr>
<th>Tool Name</th>
<th align="center">Url</th>
<th align="center">Reference Count (Feb 2017)</th>
<th align="center">Reference Count (Nov 2017)</th>
</tr>
</thead>
<tbody><tr>
<td>Makefile</td>
<td align="center"><a href="">Makefile</a></td>
<td align="center">199</td>
<td align="center">181</td>
</tr>
<tr>
<td>dep</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/golang/dep">dep</a></td>
<td align="center">N/A</td>
<td align="center">94</td>
</tr>
<tr>
<td>godep</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/tools/godep">godep</a></td>
<td align="center">119</td>
<td align="center">90</td>
</tr>
<tr>
<td>govendor</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/kardianos/govendor">govendor</a></td>
<td align="center">65</td>
<td align="center">84</td>
</tr>
<tr>
<td>glide</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/Masterminds/glide">glide</a></td>
<td align="center">64</td>
<td align="center">77</td>
</tr>
<tr>
<td>gvt</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/FiloSottile/gvt">gvt</a></td>
<td align="center">25</td>
<td align="center">16</td>
</tr>
<tr>
<td>trash</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/rancher/trash">trash</a></td>
<td align="center">7</td>
<td align="center">13</td>
</tr>
<tr>
<td>submodule</td>
<td align="center"><a href="">submodule</a></td>
<td align="center">8</td>
<td align="center">6</td>
</tr>
<tr>
<td>gpm/johnny-deps</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/pote/gpm">gpm</a> <a target="_blank" rel="noopener" href="https://github.com/VividCortex/johnny-deps">johnny-deps</a></td>
<td align="center">7</td>
<td align="center">6</td>
</tr>
<tr>
<td>glock</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/robfig/glock">glock</a></td>
<td align="center">5</td>
<td align="center">4</td>
</tr>
<tr>
<td>gom</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/mattn/gom">gom</a></td>
<td align="center">4</td>
<td align="center">2</td>
</tr>
<tr>
<td>gopack</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/d2fn/gopack">gopack</a></td>
<td align="center">3</td>
<td align="center">2</td>
</tr>
<tr>
<td>gopm</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/gpmgo/gopm">gopm</a></td>
<td align="center">3</td>
<td align="center">1</td>
</tr>
<tr>
<td>goop</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/nitrous-io/goop">goop</a></td>
<td align="center">1</td>
<td align="center">1</td>
</tr>
<tr>
<td>gvend</td>
<td align="center"><a target="_blank" rel="noopener" href="https://github.com/govend/govend">gvend</a></td>
<td align="center">2</td>
<td align="center">0</td>
</tr>
</tbody></table>
<p><a target="_blank" rel="noopener" href="https://github.com/golang/dep">dep</a> had a first release in May 2017, did not exist for first stats.</p>
<p>Technically, <code>make</code> is not a package management tool, here it is just for comparison.</p>
<p>Submodule refers to a set of tools which use <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-submodule">git submodule</a> to manage dependencies such as <a target="_blank" rel="noopener" href="https://github.com/kovetskiy/manul">manul</a> and <a target="_blank" rel="noopener" href="https://github.com/dpw/vendetta">Vendetta</a> and so on.</p>
<h2 id="Algorithm-1"><a href="#Algorithm-1" class="headerlink" title="Algorithm"></a>Algorithm</h2><ul>
<li>Clone top 1000 Go repositories to local disk</li>
<li>Analyze the repositories by identity files:</li>
</ul>
<table>
<thead>
<tr>
<th>Tool Name</th>
<th align="center">Identity Files</th>
</tr>
</thead>
<tbody><tr>
<td>godep</td>
<td align="center">Godeps/Godeps.json</td>
</tr>
<tr>
<td>govendor</td>
<td align="center">vendor/vendor.json</td>
</tr>
<tr>
<td>gopm</td>
<td align="center">.gopmfile</td>
</tr>
<tr>
<td>gvt</td>
<td align="center">vendor/manifest</td>
</tr>
<tr>
<td>gvend</td>
<td align="center">vendor.yml</td>
</tr>
<tr>
<td>glide</td>
<td align="center">glide.yaml or glide.lock</td>
</tr>
<tr>
<td>trash</td>
<td align="center">vendor.conf</td>
</tr>
<tr>
<td>gom</td>
<td align="center">Gomfile</td>
</tr>
<tr>
<td>bunch</td>
<td align="center">bunchfile</td>
</tr>
<tr>
<td>goop</td>
<td align="center">Goopfile</td>
</tr>
<tr>
<td>goat</td>
<td align="center">.go.yaml</td>
</tr>
<tr>
<td>glock</td>
<td align="center">GLOCKFILE</td>
</tr>
<tr>
<td>gobs</td>
<td align="center">goproject.json</td>
</tr>
<tr>
<td>gopack</td>
<td align="center">gopack.config</td>
</tr>
<tr>
<td>nut</td>
<td align="center">Nut.toml</td>
</tr>
<tr>
<td>gpm/johnny-deps</td>
<td align="center">Godeps</td>
</tr>
<tr>
<td>Makefile</td>
<td align="center">makefile or Makefile</td>
</tr>
<tr>
<td>submodule</td>
<td align="center">.gitmodules</td>
</tr>
</tbody></table>
<h2 id="How-1"><a href="#How-1" class="headerlink" title="How"></a>How</h2><ul>
<li>Make sure <a target="_blank" rel="noopener" href="https://git-scm.com/">Git</a>/<a target="_blank" rel="noopener" href="http://www.groovy-lang.org/download.html">Groovy 2.4+</a>/<a target="_blank" rel="noopener" href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html">JDK 1.7+</a> are installed.</li>
<li>Run <code>groovy GithubTopRankCrawler.groovy -l go -d &lt;path to store the 1000 repos&gt;</code> to clone all repositories locally. You can use <code>-s</code> to do the shallow clone and decrease disk usage.</li>
<li>Run <code>groovy GoBuildToolScanner.groovy &lt;path to store the 1000 repos&gt;</code> to analyze these repos.</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-01-29T16:46:59.000Z" title="1/29/2019, 4:46:59 PM">2019-01-29</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约30个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/29/HexoClient1-2-5%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/">HexoClient1.2.5版本发布</a></h1><div class="content"><h2 id="发布地址"><a href="#发布地址" class="headerlink" title="发布地址"></a>发布地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.5">https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.5</a></p>
<h2 id="功能预览"><a href="#功能预览" class="headerlink" title="功能预览"></a>功能预览</h2><p><img src="https://www.mspring.org/images/2019/01/29/9a633940-2384-11e9-a26e-272a27c47ef2.gif"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-01-24T11:15:07.000Z" title="1/24/2019, 11:15:07 AM">2019-01-24</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约65个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/24/hexo-client-1.2.4-release/">HexoClient1.2.4版本发布</a></h1><div class="content"><h2 id="发布地址"><a href="#发布地址" class="headerlink" title="发布地址"></a>发布地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.4">https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.4</a></p>
<h2 id="更新内容"><a href="#更新内容" class="headerlink" title="更新内容"></a>更新内容</h2><ul>
<li>新增分类标签导航</li>
<li>支持自定义文章路径</li>
<li>修复若干BUG</li>
</ul>
<h2 id="功能预览"><a href="#功能预览" class="headerlink" title="功能预览"></a>功能预览</h2><p><img src="http://file.mspring.org/images/blog/FpVFNRfqb1r8SL8WmWPwrZwNqE2M" alt="QQ20190124111534.png"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-01-15T18:09:01.000Z" title="1/15/2019, 6:09:01 PM">2019-01-15</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约100个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/15/Git%E4%BB%93%E5%BA%93%E5%88%9D%E5%A7%8B%E5%8C%96/">Git仓库初始化</a></h1><div class="content"><h3 id="Create-a-new-repository"><a href="#Create-a-new-repository" class="headerlink" title="Create a new repository"></a>Create a new repository</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:gaoyoubo/hexo-client.git</span><br><span class="line">cd user-center-transfer</span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;add README&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<h3 id="Existing-folder"><a href="#Existing-folder" class="headerlink" title="Existing folder"></a>Existing folder</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd existing_folder</span><br><span class="line">git init</span><br><span class="line">git remote add origin git@github.com:gaoyoubo/hexo-client.git</span><br><span class="line">git add .</span><br><span class="line">git commit -m &quot;Initial commit&quot;</span><br><span class="line">git push -u origin master</span><br></pre></td></tr></table></figure>

<h3 id="Existing-Git-repository"><a href="#Existing-Git-repository" class="headerlink" title="Existing Git repository"></a>Existing Git repository</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd existing_repo</span><br><span class="line">git remote rename origin old-origin</span><br><span class="line">git remote add origin git@github.com:gaoyoubo/hexo-client.git</span><br><span class="line">git push -u origin --all</span><br><span class="line">git push -u origin --tags</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2019-01-02T12:04:49.000Z" title="1/2/2019, 12:04:49 PM">2019-01-02</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约69个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2019/01/02/HexoClient1-2-3%E7%89%88%E6%9C%AC%E5%8F%91%E5%B8%83/">HexoClient1.2.3版本发布</a></h1><div class="content"><h2 id="发布地址"><a href="#发布地址" class="headerlink" title="发布地址"></a>发布地址</h2><p><a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.3">https://github.com/gaoyoubo/hexo-client/releases/tag/v1.2.3</a></p>
<h2 id="本次更新内容"><a href="#本次更新内容" class="headerlink" title="本次更新内容"></a>本次更新内容</h2><ul>
<li>支持i18n</li>
<li>新增sm.ms图床</li>
<li>支持上传粘贴板图片</li>
<li>优化设置页面布局</li>
<li>修复发布时仅支持master分支的问题</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-12-24T11:51:10.000Z" title="12/24/2018, 11:51:10 AM">2018-12-24</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">13 分钟读完 (大约1901个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/12/24/JWT%E4%BB%8B%E7%BB%8D/">JWT介绍</a></h1><div class="content"><p>JWT全称为：JSON Web Token是目前最流行的跨域认证的解决方案。</p>
<h2 id="跨域认证的问题"><a href="#跨域认证的问题" class="headerlink" title="跨域认证的问题"></a>跨域认证的问题</h2><p>互联网服务离不开用户认证。一般流程是下面这样。</p>
<ol>
<li>用户向服务器发送用户名和密码。</li>
<li>服务器验证通过后，在当前对话（session）里面保存相关数据，比如用户角色、登录时间等等。</li>
<li>服务器向用户返回一个 session_id，写入用户的 Cookie。</li>
<li>用户随后的每一次请求，都会通过 Cookie，将 session_id 传回服务器。</li>
<li>服务器收到 session_id，找到前期保存的数据，由此得知用户的身份。</li>
</ol>
<p><img src="http://file.mspring.org/images/blog/Fk90d0HAnG1mMX1hyG1WrOh6qjnl" alt="image.png"></p>
<p>这种模式的问题在于，扩展性不好。单机当然没有问题，如果是服务器集群，或者是跨域的服务导向架构，就要求 session 数据共享，每台服务器都能够读取 session。</p>
<p>举例来说，A 网站和 B 网站是同一家公司的关联服务。现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现？</p>
<p>一种解决方案是 session 数据持久化，写入数据库或别的持久层。各种服务收到请求后，都向持久层请求数据。这种方案的优点是架构清晰，缺点是工程量比较大。另外，持久层万一挂了，就会单点失败。</p>
<p><img src="http://file.mspring.org/images/blog/Fvvi55Uc24iyk-WIiB_D81JY7mTz" alt="image.png"></p>
<p>另一种方案是服务器索性不保存 session 数据了，所有数据都保存在客户端，每次请求都发回服务器。JWT 就是这种方案的一个代表。</p>
<h2 id="JWT的原理"><a href="#JWT的原理" class="headerlink" title="JWT的原理"></a>JWT的原理</h2><p>JWT的原则是在服务器身份验证之后，将生成一个JSON对象并将其发送回用户，如下所示。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;username&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;role&quot;</span>: <span class="string">&quot;admin&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;expire&quot;</span>: <span class="string">&quot;2018-12-24 20:15:56&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以后，用户与服务端通信的时候，都要发回这个 JSON 对象。服务器完全只靠这个对象认定用户身份。为了防止用户篡改数据，服务器在生成这个对象的时候，会加上签名（详见后文）。</p>
<p>服务器就不保存任何 session 数据了，也就是说，服务器变成无状态了，从而比较容易实现扩展。</p>
<h2 id="JWT的数据结构"><a href="#JWT的数据结构" class="headerlink" title="JWT的数据结构"></a>JWT的数据结构</h2><p>实际的 JWT 大概就像下面这样。<br><img src="http://file.mspring.org/images/blog/FmS-44Gi8Ys2j9KPAlhJCbxwBOff" alt="image.png"></p>
<p>它是一个很长的字符串，中间用点<code>.</code>分隔成三个部分。注意，JWT 内部是没有换行的，这里只是为了便于展示，将它写成了几行。</p>
<p>JWT 的三个部分依次如下。</p>
<ul>
<li>Header (头)</li>
<li>Payload (负载)</li>
<li>Signature (签名)<br>写成一行，就是下面的样子：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Header.Payload.Signature</span><br></pre></td></tr></table></figure>
<img src="http://file.mspring.org/images/blog/FvhP9xjo2LBg-e747BzPEYeteJ_2" alt="image.png"><br>下面依次介绍这三个部分。</li>
</ul>
<h3 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h3><p>Header 部分是一个 JSON 对象，描述 JWT 的元数据，通常是下面的样子。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面代码中，alg属性表示签名的算法（algorithm），默认是 HMAC SHA256（写成 HS256）；typ属性表示这个令牌（token）的类型（type），JWT令牌统一写为JWT。<br>最后，将上面的 JSON 对象使用 Base64URL 算法（详见后文）转成字符串。</p>
<p>JWT里验证和签名使用的算法，可选择下面的:</p>
<table>
<thead>
<tr>
<th>JWS</th>
<th>算法名称</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>HS256</td>
<td>HMAC256</td>
<td>HMAC with SHA-256</td>
</tr>
<tr>
<td>HS384</td>
<td>HMAC384</td>
<td>HMAC with SHA-384</td>
</tr>
<tr>
<td>HS512</td>
<td>HMAC512</td>
<td>HMAC with SHA-512</td>
</tr>
<tr>
<td>RS256</td>
<td>RSA256</td>
<td>RSASSA-PKCS1-v1_5 with SHA-256</td>
</tr>
<tr>
<td>RS384</td>
<td>RSA384</td>
<td>RSASSA-PKCS1-v1_5 with SHA-384</td>
</tr>
<tr>
<td>RS512</td>
<td>RSA512</td>
<td>RSASSA-PKCS1-v1_5 with SHA-512</td>
</tr>
<tr>
<td>ES256</td>
<td>ECDSA256</td>
<td>ECDSA with curve P-256 and SHA-256</td>
</tr>
<tr>
<td>ES384</td>
<td>ECDSA384</td>
<td>ECDSA with curve P-384 and SHA-384</td>
</tr>
<tr>
<td>ES512</td>
<td>ECDSA512</td>
<td>ECDSA with curve P-521 and SHA-512</td>
</tr>
</tbody></table>
<h3 id="Payload"><a href="#Payload" class="headerlink" title="Payload"></a>Payload</h3><p>Payload 部分也是一个 JSON 对象，用来存放实际需要传递的数据。JWT 规定了7个官方字段，供选用。</p>
<ul>
<li>iss (issuer)：签发人</li>
<li>exp (expiration time)：过期时间</li>
<li>sub (subject)：主题</li>
<li>aud (audience)：受众</li>
<li>nbf (Not Before)：生效时间</li>
<li>iat (Issued At)：签发时间</li>
<li>jti (JWT ID)：编号<br>除了官方字段，你还可以在这个部分定义私有字段，下面就是一个例子。<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;sub&quot;</span>: <span class="string">&quot;1234567890&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;admin&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
注意，JWT 默认是不加密的，任何人都可以读到，所以不要把秘密信息放在这个部分。<br>这个 JSON 对象也要使用 Base64URL 算法转成字符串。</li>
</ul>
<h3 id="Signature"><a href="#Signature" class="headerlink" title="Signature"></a>Signature</h3><p>Signature 部分是对前两部分的签名，防止数据篡改。</p>
<p>首先，需要指定一个密钥（secret）。这个密钥只有服务器才知道，不能泄露给用户。然后，使用 Header 里面指定的签名算法（默认是 HMAC SHA256），按照下面的公式产生签名。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + <span class="string">&quot;.&quot;</span> +</span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure>
<p>算出签名以后，把 Header、Payload、Signature 三个部分拼成一个字符串，每个部分之间用<code>.</code>分隔，就可以返回给用户。</p>
<h3 id="Base64URL"><a href="#Base64URL" class="headerlink" title="Base64URL"></a>Base64URL</h3><p>前面提到，Header 和 Payload 串型化的算法是 Base64URL。这个算法跟 Base64 算法基本类似，但有一些小的不同。</p>
<p>JWT 作为一个令牌（token），有些场合可能会放到 URL（比如 api.example.com/?token=xxx）。Base64 有三个字符<code>+</code>、<code>/</code>和<code>=</code>，在 URL 里面有特殊含义，所以要被替换掉：<code>=</code>被省略，<code>+</code>替换成<code>-</code>，<code>/</code>替换成<code>_</code>。这就是Base64URL 算法。</p>
<h2 id="JWT的使用方式"><a href="#JWT的使用方式" class="headerlink" title="JWT的使用方式"></a>JWT的使用方式</h2><p>客户端收到服务器返回的 JWT，可以储存在 Cookie 里面，也可以储存在 localStorage。</p>
<p>此后，客户端每次与服务器通信，都要带上这个 JWT。你可以把它放在 Cookie 里面自动发送，但是这样不能跨域，所以更好的做法是放在 HTTP 请求的头信息<code>Authorization</code>字段里面。</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Authorization: Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure>
<p>另一种做法是，跨域的时候，JWT 就放在 POST 请求的数据体里面。</p>
<h2 id="JWT-的几个特点"><a href="#JWT-的几个特点" class="headerlink" title="JWT 的几个特点"></a>JWT 的几个特点</h2><ul>
<li>JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。</li>
<li>JWT 不加密的情况下，不能将秘密数据写入 JWT。</li>
<li>JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。</li>
<li>JWT 的最大缺点是，由于服务器不保存 session 状态，因此无法在使用过程中废止某个 token，或者更改 token 的权限。也就是说，一旦 JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑。</li>
<li>JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。</li>
<li>为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。</li>
</ul>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li>官方介绍页：<a target="_blank" rel="noopener" href="https://jwt.io/introduction/">https://jwt.io/introduction/</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-11-26T17:53:48.000Z" title="11/26/2018, 5:53:48 PM">2018-11-26</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">2 分钟读完 (大约347个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/11/26/%E4%BD%BF%E7%94%A8AppVeyor%E5%92%8CTravis%E8%87%AA%E5%8A%A8%E7%BC%96%E8%AF%91Electron%E5%85%A8%E5%B9%B3%E5%8F%B0%E5%BA%94%E7%94%A8/">使用AppVeyor和Travis自动编译Electron全平台应用</a></h1><div class="content"><h2 id="package-json配置"><a href="#package-json配置" class="headerlink" title="package.json配置"></a>package.json配置</h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;HexoClient&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.2.2&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;......&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;Hexo 桌面客户端&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;Apache License, Version 2.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;homepage&quot;</span>: <span class="string">&quot;https://github.com/gaoyoubo/hexo-client&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;repository&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;git&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;url&quot;</span>: <span class="string">&quot;https://github.com/gaoyoubo/hexo-client.git&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;./dist/electron/main.js&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;node .electron-vue/build.js &amp;&amp; electron-builder --publish onTagOrDraft&quot;</span></span><br><span class="line">    ......</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;build&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;appId&quot;</span>: <span class="string">&quot;org.mspring.hexo.client&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;productName&quot;</span>: <span class="string">&quot;HexoClient&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;directories&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;output&quot;</span>: <span class="string">&quot;build&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;files&quot;</span>: [</span><br><span class="line">      <span class="string">&quot;dist/electron/**/*&quot;</span>,</span><br><span class="line">      <span class="string">&quot;build/icons/*&quot;</span></span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">&quot;publish&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;provider&quot;</span>: <span class="string">&quot;github&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;owner&quot;</span>: <span class="string">&quot;gaoyoubo&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;repo&quot;</span>: <span class="string">&quot;hexo-client&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;dmg&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;contents&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;x&quot;</span>: <span class="number">410</span>,</span><br><span class="line">          <span class="attr">&quot;y&quot;</span>: <span class="number">150</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;link&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/Applications&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;x&quot;</span>: <span class="number">130</span>,</span><br><span class="line">          <span class="attr">&quot;y&quot;</span>: <span class="number">150</span>,</span><br><span class="line">          <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;file&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;mac&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;icon&quot;</span>: <span class="string">&quot;build/icons/icon.icns&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;win&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;nsis&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;icon&quot;</span>: <span class="string">&quot;build/icons/icon.ico&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;linux&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;category&quot;</span>: <span class="string">&quot;Utility&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;target&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;AppImage&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;arch&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;x64&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ia32&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;deb&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;arch&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;x64&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ia32&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;target&quot;</span>: <span class="string">&quot;rpm&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;arch&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;x64&quot;</span>,</span><br><span class="line">            <span class="string">&quot;ia32&quot;</span></span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;icon&quot;</span>: <span class="string">&quot;build/icons&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="build配置"><a href="#build配置" class="headerlink" title="build配置"></a>build配置</h3><p>electron-builder支持构建多个平台安装包，上面的配置中我配置了Windows、macos、linux，可以直接拷贝使用，如果想了解更多可以看这篇官方出品的文档：<a target="_blank" rel="noopener" href="https://www.electron.build/configuration/configuration">https://www.electron.build/configuration/configuration</a></p>
<h3 id="构建命令配置"><a href="#构建命令配置" class="headerlink" title="构建命令配置"></a>构建命令配置</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node .electron-vue/build.js &amp;&amp; electron-builder --publish onTagOrDraft</span><br></pre></td></tr></table></figure>
<p>可以看到后面的参数<code>--publish onTagOrDraft</code>他的意思是，当在标签中提交，或github中存在draft发布版本的时候触发publish操作，这个时候会自动将构建好的包上传到github releases中。publish配置的取值如下：</p>
<table>
<thead>
<tr>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>onTag</td>
<td>on tag push only</td>
</tr>
<tr>
<td>onTagOrDraft</td>
<td>on tag push or if draft release exists</td>
</tr>
<tr>
<td>always</td>
<td>always publish</td>
</tr>
<tr>
<td>never</td>
<td>never publish</td>
</tr>
</tbody></table>
<h2 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h2><ul>
<li><a target="_blank" rel="noopener" href="https://www.appveyor.com/">AppVeyor</a></li>
<li><a target="_blank" rel="noopener" href="https://travis-ci.org/">Travis</a></li>
<li><a target="_blank" rel="noopener" href="https://www.electron.build/configuration/configuration">electron-builder官方文档</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client/issues/15">https://github.com/gaoyoubo/hexo-client/issues/15</a></li>
<li><a target="_blank" rel="noopener" href="https://juejin.im/entry/5995599a6fb9a0249f6a131b">https://juejin.im/entry/5995599a6fb9a0249f6a131b</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-11-17T14:10:30.000Z" title="11/17/2018, 2:10:30 PM">2018-11-17</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/">碎碎念</a></span><span class="level-item">几秒读完 (大约54个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/11/17/HexoClient%E8%A2%ABElectron%E5%BA%94%E7%94%A8%E4%B8%AD%E5%BF%83%E6%94%B6%E5%BD%95/">HexoClient被Electron应用中心收录</a></h1><div class="content"><p>今天打开electron的app中心发现HexoClient已经被收录了，纪念一下。<br>地址：<a target="_blank" rel="noopener" href="https://electronjs.org/apps/hexo-client">https://electronjs.org/apps/hexo-client</a></p>
<p><img src="http://file.mspring.org/images/blog/381fb84740fb2a5801df031af1c41a0f!detail"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-11-10T16:41:24.000Z" title="11/10/2018, 4:41:24 PM">2018-11-10</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">2 分钟读完 (大约249个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/11/10/Hexo1-2-0%E5%8F%91%E5%B8%83%EF%BC%8C%E5%85%A8%E6%96%B0%E7%9A%84UI%E5%B8%83%E5%B1%80/">Hexo1.2.0发布，全新的UI布局</a></h1><div class="content"><p>Hexo1.2.0发布，全新的UI布局。</p>
<blockquote>
<p>之前一直觉得HexoClient的ui太不像一个原生应用，一眼就能看出是网页做的。同样是基于electron，vscode、atom等应用的ui看起来就特别正规、好看，所以这次周末抽一天时间调整一下UI。</p>
</blockquote>
<h3 id="本次更新内容"><a href="#本次更新内容" class="headerlink" title="本次更新内容"></a>本次更新内容</h3><ul>
<li>MacOS下无边框样式</li>
<li>调整菜单栏布局</li>
<li>修改UI配色和界面细节</li>
<li>修复初始化时选择hexo目录失败的问题</li>
<li>升级electron版本到3.x</li>
<li>其他细节修改</li>
</ul>
<p><img src="http://file.mspring.org/images/blog/2a610b3b3e6a4dfc1132039145832472!detail"></p>
<p><img src="http://file.mspring.org/images/blog/0021d74d369085c91e861d483659fa32!detail"></p>
<h3 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h3><p>Mac版：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1E-5KrusoBuFGRTunTBqPJQ">https://pan.baidu.com/s/1E-5KrusoBuFGRTunTBqPJQ</a>   提取码：2v2q<br>Windows版本：请自行源码编译。<br>Linux版本：请自行源码编译。</p>
<h3 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h3><p>Github: <a target="_blank" rel="noopener" href="https://github.com/gaoyoubo/hexo-client">https://github.com/gaoyoubo/hexo-client</a><br>码云：<a target="_blank" rel="noopener" href="https://gitee.com/gaoyoubo/hexo-client">https://gitee.com/gaoyoubo/hexo-client</a></p>
<h3 id="TODO"><a href="#TODO" class="headerlink" title="TODO"></a>TODO</h3><ul>
<li>自动初始化hexo</li>
<li>文章筛选、搜索</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-11-07T14:48:31.000Z" title="11/7/2018, 2:48:31 PM">2018-11-07</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">3 分钟读完 (大约443个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/11/07/%E6%90%AC%E7%93%A6%E5%B7%A5%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/">搬瓦工使用笔记</a></h1><div class="content"><p>之前一直使用朋友的vpn进行翻墙，今天突然发现用不了了，同事强烈推荐使用<code>搬瓦工</code>（ <a target="_blank" rel="noopener" href="https://bwh8.net/">https://bwh8.net</a> ），他们反馈很稳定。于是就去官网上买了一个最低配的，配置如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SSD: 10 GB RAID-10</span><br><span class="line">RAM: 512 MB</span><br><span class="line">CPU: 1x Intel Xeon</span><br><span class="line">Transfer: 500 GB&#x2F;mo</span><br><span class="line">Link speed: 1 Gigabit</span><br><span class="line">Multiple locations</span><br></pre></td></tr></table></figure>
<p>价格：$19.99/year</p>
<p>购买的时候可以输入优惠码，优惠码自行百度去，有很多资源。我找了个优惠码，优惠了6.25%</p>
<p>接下来就是配置Shadowsocks Server了， 之前网上的教程中都会看到虚拟机vps的控制台会有一个Shadowsocks Server的选项，进去之后能够一键安装配置该服务，但是我的控制台却没有这个选项，在网上找到了下面一段话。</p>
<blockquote>
<p>注：最近很多新购买的服务器在VPS管理面板没有“Shadowsocks server”这一项，若是发生此原因，请按如下操作即可正常安装！若页面中没有Shadowsocks Server这一项，说明一键搭建SS功能被去掉了，这时候需要在当前浏览器的新标签中打开以下网址：<br><a target="_blank" rel="noopener" href="https://kiwivm.64clouds.com/main-exec.php?mode=extras_shadowsocks">https://kiwivm.64clouds.com/main-exec.php?mode=extras_shadowsocks</a>  打开以后就是安装页面，点击页面中的Install Shadowsocks Server安装即可(安装前提是服务器已打开已运行)。</p>
</blockquote>
<p>目前已经按照上面链接中的步骤搞定翻墙了。</p>
<p>另外附上Shadowsocks-NG下载地址：<a target="_blank" rel="noopener" href="https://github.com/shadowsocks/ShadowsocksX-NG/releases">https://github.com/shadowsocks/ShadowsocksX-NG/releases</a></p>
<p><img src="http://file.mspring.org/images/blog/6f8446dc093ef265589b488f926e5a7c"><br><img src="http://file.mspring.org/images/blog/12e4f270766776f570a24d33c45f56c1"><br><img src="http://file.mspring.org/images/blog/e9409572d6243e760faa218bd505f7b8"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-10-30T15:02:55.000Z" title="10/30/2018, 3:02:55 PM">2018-10-30</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">3 分钟读完 (大约516个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/10/30/Java%E5%AD%A6%E4%B9%A0%E8%B5%84%E6%96%99/">Java学习资料</a></h1><div class="content"><blockquote>
<p>前几天突然有个姑娘加我的QQ（不知道哪儿来的我的QQ），让我参加他们免费的公开课，然后给我分享Java学习资料，我以为是会给我发几本书，就参加了，没想到是一个txt文件😂，内容如下：</p>
</blockquote>
<p>Allen-架构师必备技能-分库分表应对数据量过大<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1OF4RUHvRk98pBRdUiifH2g">https://pan.baidu.com/s/1OF4RUHvRk98pBRdUiifH2g</a> 密码：n4ev</p>
<p>Allen-互联网安全话题-使用https保障你的敏感数据不再裸奔<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1qz23y-3ahaGua4YH02KTyw">https://pan.baidu.com/s/1qz23y-3ahaGua4YH02KTyw</a> 密码：fgh0</p>
<p>Tony-多线程Future模式-写出支撑海量并发连接的服务端代码<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1NwzNRxUB0_DPNQo2IW_Xhg">https://pan.baidu.com/s/1NwzNRxUB0_DPNQo2IW_Xhg</a> 密码：0fpw</p>
<p>Tony-前后端分离架构分析与实现<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1b7XnTibtqW26YCHfuAXkyA">https://pan.baidu.com/s/1b7XnTibtqW26YCHfuAXkyA</a> 密码：ah24</p>
<p>Tony-高并发系统架构之负载均衡全方位解析<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1a87EH1Xe20O4XYZaNRo-hw">https://pan.baidu.com/s/1a87EH1Xe20O4XYZaNRo-hw</a> 密码：p52e</p>
<p>Tony-学会举一反三-从Redis看RPC原理<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1disSAbJo-01ESCu6_rTHYQ">https://pan.baidu.com/s/1disSAbJo-01ESCu6_rTHYQ</a> 密码：ih47</p>
<p>-Mike-分布式系统架构技能—zookeeper实现分布式锁<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1adhFuoUsz1sMQTnWNGoKPA">https://pan.baidu.com/s/1adhFuoUsz1sMQTnWNGoKPA</a> 密码：gjzh</p>
<p>Tony-数据库连接池原理源码分析<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1uBiBBt-tJVSz_5t5p4jG3A">https://pan.baidu.com/s/1uBiBBt-tJVSz_5t5p4jG3A</a> 密码：jqo6</p>
<p>Allen-深入SpringMVC原理老司机带你手写自己的MVC框架<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1rlhZCSqXaZpXWM_V5CA7EQ">https://pan.baidu.com/s/1rlhZCSqXaZpXWM_V5CA7EQ</a> 密码：vysj</p>
<p>Tony-JVM类加载机制之JAVA热部署实战开发<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1JSLGrG0k44um7weQcq5rvg">https://pan.baidu.com/s/1JSLGrG0k44um7weQcq5rvg</a> 密码：twn3</p>
<p>Tony-实战高并发系统缓存雪崩场景重现及解决方案<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1i8Q7sPNEcUIPYBuqFerRwQ">https://pan.baidu.com/s/1i8Q7sPNEcUIPYBuqFerRwQ</a> 密码：lwgj</p>
<p>Mike-解密spring-boot-starter<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/12-1N3RTb68l3QfUOxSG1jQ">https://pan.baidu.com/s/12-1N3RTb68l3QfUOxSG1jQ</a> 密码：sodb</p>
<p>Tony-细说springcloud微服务架构之客户端负载均衡<br>链接：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1VK3mMTkKYzRU4G9YXwlOLg">https://pan.baidu.com/s/1VK3mMTkKYzRU4G9YXwlOLg</a> 密码：achq</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-10-25T18:35:18.000Z" title="10/25/2018, 6:35:18 PM">2018-10-25</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约102个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/10/25/%E8%B4%A6%E5%8F%B7%E4%B8%AD%E5%BF%83%E6%9C%8D%E5%8A%A1%E7%BA%BF%E4%B8%8A%E7%A8%B3%E5%AE%9A%E4%B8%80%E5%B9%B4%E7%BA%AA%E5%BF%B5/">账号中心服务线上稳定一年纪念</a></h1><div class="content"><p>这台服务由三台机器负载，每日处理一亿四千万+次请求，线上稳定运营一年多，未出现任何故障，如果不是这次需求变动还能继续稳定运行。在重启县截图纪念一下。</p>
<p><img src="http://file.mspring.org/images/blog/4cf2110bad00ed8f9b8e9726ddea7cc4"><br><img src="http://file.mspring.org/images/blog/c75ddcffe7c32f9d32816c421d08a63d"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-10-24T15:18:12.000Z" title="10/24/2018, 3:18:12 PM">2018-10-24</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">16 分钟读完 (大约2460个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/10/24/TOP-10%E5%BC%80%E6%BA%90%E7%9A%84%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F%E7%AE%80%E4%BB%8B/">TOP 10开源的推荐系统简介</a></h1><div class="content"><blockquote>
<p>转载自：<a target="_blank" rel="noopener" href="http://ibillxia.github.io/blog/2014/03/10/top-10-open-source-recommendation-systems/">http://ibillxia.github.io/blog/2014/03/10/top-10-open-source-recommendation-systems/</a></p>
</blockquote>
<p>最近这两年推荐系统特别火，本文搜集整理了一些比较好的开源推荐系统，即有轻量级的适用于做研究的SVDFeature、LibMF、LibFM等，也有重量级的适用于工业系统的 Mahout、Oryx、EasyRecd等</p>
<h1 id="SVDFeature"><a href="#SVDFeature" class="headerlink" title="SVDFeature"></a>SVDFeature</h1><p><img src="http://file.mspring.org/images/blog/b03f7c80c02987e7530f4d3b4e3aaa06"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://svdfeature.apexlab.org/wiki/Main_Page">http://svdfeature.apexlab.org/wiki/Main_Page</a> 语言：C++<br>一个feature-based协同过滤和排序工具，由上海交大Apex实验室开发，代码质量较高。在KDD Cup 2012中获得第一名，KDD Cup 2011中获得第三名，相关论文 发表在2012的JMLR中，这足以说明它的高大上。<br>SVDFeature包含一个很灵活的Matrix Factorization推荐框架，能方便的实现SVD、SVD++等方法, 是单模型推荐算法中精度最高的一种。SVDFeature代码精炼，可以用 相对较少的内存实现较大规模的单机版矩阵分解运算。另外含有Logistic regression的model，可以很方便的用来进行ensemble。</p>
<h1 id="LibMF"><a href="#LibMF" class="headerlink" title="LibMF"></a>LibMF</h1><p><img src="http://file.mspring.org/images/blog/8fa6443aa809ba8fbc5e3c64915c521c"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://www.csie.ntu.edu.tw/~cjlin/libmf/">http://www.csie.ntu.edu.tw/~cjlin/libmf/</a> 语言：C++<br>作者<a target="_blank" rel="noopener" href="http://www.csie.ntu.edu.tw/~cjlin/">Chih-Jen Lin</a>来自大名鼎鼎的台湾国立大学，他们在机器学习领域享有盛名，近年连续多届KDD Cup竞赛上均 获得优异成绩，并曾连续多年获得冠军。台湾大学的风格非常务实，业界常用的LibSVM， Liblinear等都是他们开发的，开源代码的效率和质量都非常高。<br>LibMF在矩阵分解的并行化方面作出了很好的贡献，针对SGD（随即梯度下降）优化方法在并行计算中存在的locking problem和memory discontinuity问题，提出了一种 矩阵分解的高效算法FPSGD（Fast Parallel SGD），根据计算节点的个数来划分评分矩阵block，并分配计算节点。系统介绍可以见这篇 <a target="_blank" rel="noopener" href="http://www.csie.ntu.edu.tw/~cjlin/papers/libmf.pdf">论文</a>（ACM Recsys 2013的 Best paper Award）。</p>
<h1 id="LibFM"><a href="#LibFM" class="headerlink" title="LibFM"></a>LibFM</h1><p><img src="http://file.mspring.org/images/blog/ea0bacfb8f5cbb8582c6da0d46b982ad"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://www.libfm.org/">http://www.libfm.org/</a> 语言：C++<br>作者是德国Konstanz大学的Steffen Rendle，他用LibFM同时玩转KDD Cup 2012 Track1和Track2两个子竞赛单元，都取得了很好的成绩，说明LibFM是非常管用的利器。<br>LibFM是专门用于矩阵分解的利器，尤其是其中实现了MCMC（Markov Chain Monte Carlo）优化算法，比常见的SGD优化方法精度要高，但运算速度要慢一些。当然LibFM中还 实现了SGD、SGDA（Adaptive SGD）、ALS（Alternating Least Squares）等算法。</p>
<h1 id="Lenskit"><a href="#Lenskit" class="headerlink" title="Lenskit"></a>Lenskit</h1><p><img src="http://file.mspring.org/images/blog/0e22bf119d7f4c18f84186b45b5f349c"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://lenskit.grouplens.org/">http://lenskit.grouplens.org/</a> 语言Java  </p>
<p>这个Java开发的开源推荐系统，来自美国的明尼苏达大学的GroupLens团队，也是推荐领域知名的测试数据集Movielens的作者。<br>该源码托管在GitHub上，<a target="_blank" rel="noopener" href="https://github.com/grouplens/lenskit">https://github.com/grouplens/lenskit</a>。主要包含lenskit-api,lenskit-core, lenskit-knn,lenskit-svd,lenskit-slopone,lenskit-parent,lenskit-data-structures,lenskit-eval,lenskit-test等模块，主要实现了k-NN，SVD，Slope-One等 典型的推荐系统算法。</p>
<h1 id="GraphLab"><a href="#GraphLab" class="headerlink" title="GraphLab"></a>GraphLab</h1><p><img src="http://file.mspring.org/images/blog/059a0e4f2135ef650c32dae1b2c0328e"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://docs.graphlab.org/collaborative_filtering.html">GraphLab - Collaborative Filtering</a> 语言：C++<br>Graphlab是基于C++开发的一个高性能分布式graph处理挖掘系统，特点是对迭代的并行计算处理能力强（这方面是hadoop的弱项），由于功能独到，GraphLab在业界名声很响。 用GraphLab来进行大数据量的random walk或graph-based的推荐算法非常有效。Graphlab虽然名气比较响亮（CMU开发），但是对一般数据量的应用来说可能还用不上。<br>GraphLab主要实现了ALS，CCD++，SGD，Bias-SGD，SVD++，Weighted-ALS，Sparse-ALS，Non-negative Matrix Factorization，Restarted Lanczos Algorithm等算法。</p>
<h1 id="Mahout"><a href="#Mahout" class="headerlink" title="Mahout"></a>Mahout</h1><p><img src="http://file.mspring.org/images/blog/abc413f7e8465030364bf52af73e744c"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://mahout.apache.org/">http://mahout.apache.org/</a> 语言：Java<br>Mahout 是 Apache Software Foundation (ASF) 开发的一个全新的开源项目，其主要目标是创建一些可伸缩的机器学习算法，供开发人员在 Apache 在许可下免费 使用。Mahout项目是由 Apache Lucene社区中对机器学习感兴趣的一些成员发起的，他们希望建立一个可靠、文档翔实、可伸缩的项目，在其中实现一些常见的用于 聚类和分类的机器学习算法。该社区最初基于 Ngetal. 的文章 “Map-Reduce for Machine Learning on Multicore”，但此后在发展中又并入了更多广泛的机器学习 方法，包括Collaborative Filtering（CF），Dimensionality Reduction，Topic Models等。此外，通过使用 Apache Hadoop 库，Mahout 可以有效地扩展到云中。<br>在Mahout的Recommendation类算法中，主要有User-Based CF，Item-Based CF，ALS，ALS on Implicit Feedback，Weighted MF，SVD++，Parallel SGD等。</p>
<h1 id="Myrrix"><a href="#Myrrix" class="headerlink" title="Myrrix"></a>Myrrix</h1><p><img src="http://file.mspring.org/images/blog/24015554dcd2411f4c2d9c2279e23c48"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://myrrix.com/">http://myrrix.com/</a> 语言：Java<br>Myrrix最初是Mahout的作者之一Sean Owen基于Mahout开发的一个试验性质的推荐系统。目前Myrrix已经是一个完整的、实时的、可扩展的集群和推荐系统，主要 架构分为两部分：服务层：在线服务，响应请求、数据读入、提供实时推荐；计算层：用于分布式离线计算，在后台使用分布式机器学习算法为服务层更新机器学习 模型。Myrrix使用这两个层构建了一个完整的推荐系统，服务层是一个HTTP服务器，能够接收更新，并在毫秒级别内计算出更新结果。服务层可以单独使用，无需 计算层，它会在本地运行机器学习算法。计算层也可以单独使用，其本质是一系列的Hadoop jobs。目前Myrrix以被 Cloudera 并入Oryx项目。</p>
<h1 id="EasyRec"><a href="#EasyRec" class="headerlink" title="EasyRec"></a>EasyRec</h1><p><img src="http://file.mspring.org/images/blog/b2a52612d4c6244354a50e02b975f08c"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://easyrec.org/">http://easyrec.org/</a> 语言：Java<br>EasyRec是一个易集成、易扩展、功能强大且具有可视化管理的推荐系统，更像一个完整的推荐产品，包括了数据录入模块、管理模块、推荐挖掘、离线分析等。 EasyRec可以同时给多个不同的网站提供推荐服务，通过tenant来区分不同的网站。架设EasyRec服务器，为网站申请tenant，通过tenant就可以很方便的集成到 网站中。通过各种不同的数据收集（view,buy.rating）API收集到网站的用户行为，EasyRec通过离线分析，就可以产生推荐信息，您的网站就可以通过 Recommendations和Community Rankings来进行推荐业务的实现。</p>
<h1 id="Waffles"><a href="#Waffles" class="headerlink" title="Waffles"></a>Waffles</h1><p><img src="http://file.mspring.org/images/blog/a2db4b985be8ea4bea49e0f178134233"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://waffles.sourceforge.net/">http://waffles.sourceforge.net/</a> 语言：C++<br>Waffles英文原意是蜂蜜甜饼，在这里却指代一个非常强大的机器学习的开源工具包。Waffles里包含的算法特别多，涉及机器学习的方方面面，推荐系统位于 其中的Waffles_recommend tool，大概只占整个Waffles的1/10的内容，其它还有分类、聚类、采样、降维、数据可视化、音频处理等许许多多工具包，估计 能与之媲美的也就数Weka了。</p>
<h1 id="RapidMiner"><a href="#RapidMiner" class="headerlink" title="RapidMiner"></a>RapidMiner</h1><p><img src="http://file.mspring.org/images/blog/833465ed8f573c31de771cd5b504cec4"></p>
<p>主页：<a target="_blank" rel="noopener" href="http://rapidminer.com/">http://rapidminer.com/</a> 语言：Java<br>RapidMiner（前身是Yale）是一个比较成熟的数据挖掘解决方案，包括常见的机器学习、NLP、推荐、预测等方法（推荐只占其中很小一部分），而且带有GUI的 数据分析环境，数据ETL、预处理、可视化、评估、部署等整套系统都有。另外RapidMiner提供commercial license，提供R语言接口，感觉在向着一个商用的 数据挖掘公司的方向在前进。  </p>
<hr>
<p>开源的推荐系统大大小小的还有很多，以上只是介绍了一些在学术界和工业界比较流行的TOP 10，而且基本上都是用C++/Java实现的，在参考资料[1]、[2]中还提 到的有Crab（Python）、CofiRank（C++）、MyMediaLite（.NET/C#）、PREA（Java）、Python-recsys（Python）、Recommendable（Ruby）、Recommenderlab（R）、 Oryx（Java）、recommendify（Ruby）、RecDB（SQL）等等，当然GitHub上还有更多。。。即有适合单机运行的，也有适合集群的。虽然使用的编程语言不同，但实现 的算法都大同小异，主要是SVD、SGD、ALS、MF、CF及其改进算法等。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="http://blog.csdn.net/cserchen/article/details/14231153">推荐系统开源软件列表汇总和点评</a>  </li>
<li><a target="_blank" rel="noopener" href="http://www.oschina.net/search?scope=project&tag1=0&tag2=0&lang=0&os=0&q=%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F">开源中国社区-搜索：推荐系统</a></li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-08-27T12:34:03.000Z" title="8/27/2018, 12:34:03 PM">2018-08-27</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">1 分钟读完 (大约138个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/27/%E5%B0%8F%E7%B1%B3%E6%89%8B%E6%9C%BA%E5%AE%89%E8%A3%85Charles%E8%AF%81%E4%B9%A6/">小米手机安装Charles证书</a></h1><div class="content"><p>平时使用Charles进行接口抓包，新换小米手机之后发现按照之前的流程安装Charles ssl证书不好使，百度了好久才找到一下解决办法。</p>
<ul>
<li>使用第三方浏览器（我用的是QQ浏览器）下载.pem 格式的文件</li>
<li>将这个文件放入小米的<code>Download</code>文件夹下</li>
<li>将.pem文件修改为.crt 格式</li>
<li>设置—更多设置—系统安全—加密与凭据—从存储设备安装–选择<code>Download</code>文件夹下的文件</li>
<li>Finish~~</li>
</ul>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-08-14T12:56:36.000Z" title="8/14/2018, 12:56:36 PM">2018-08-14</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">6 分钟读完 (大约865个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/14/javacv%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/">javacv使用笔记</a></h1><div class="content"><h2 id="使用过程中遇到的异常"><a href="#使用过程中遇到的异常" class="headerlink" title="使用过程中遇到的异常"></a>使用过程中遇到的异常</h2><h3 id="异常：Could-not-initialize-class-org-bytedeco-javacpp-avutil"><a href="#异常：Could-not-initialize-class-org-bytedeco-javacpp-avutil" class="headerlink" title="异常：Could not initialize class org.bytedeco.javacpp.avutil"></a>异常：Could not initialize class org.bytedeco.javacpp.avutil</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: Could not initialize class org.bytedeco.javacpp.avutil</span><br><span class="line">at java.lang.Class.forName0(Native Method)</span><br><span class="line">at java.lang.Class.forName(Class.java:274)</span><br><span class="line">at org.bytedeco.javacpp.Loader.load(Loader.java:385)</span><br><span class="line">at org.bytedeco.javacpp.Loader.load(Loader.java:353)</span><br><span class="line">at org.bytedeco.javacpp.avformat$AVFormatContext.&lt;clinit&gt;(avformat.java:2249)</span><br><span class="line">at org.bytedeco.javacv.FFmpegFrameGrabber.startUnsafe(FFmpegFrameGrabber.java:346)</span><br><span class="line">at org.bytedeco.javacv.FFmpegFrameGrabber.start(FFmpegFrameGrabber.java:340)</span><br></pre></td></tr></table></figure>
<p>解决办法：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn package exec:java -Dplatform.dependencies -Dexec.mainClass=Demo</span><br></pre></td></tr></table></figure>

<h3 id="警告：Warning-data-is-not-aligned-This-can-lead-to-a-speedloss"><a href="#警告：Warning-data-is-not-aligned-This-can-lead-to-a-speedloss" class="headerlink" title="警告：Warning: data is not aligned! This can lead to a speedloss"></a>警告：Warning: data is not aligned! This can lead to a speedloss</h3><p>出现这个警告是因为ffmpeg要求视频的宽度必须是32的倍数，高度必须是2的倍数，按要求修改下宽高就好了。</p>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.FileUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.math.NumberUtils;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacpp.avcodec;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacpp.opencv_core;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacpp.opencv_imgcodecs;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacv.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Gao Youbo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018-08-15 16:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OpenCVUtils</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;BufferedImage&gt; images = grab(<span class="keyword">new</span> File(<span class="string">&quot;/data/opencv/test.mp4&quot;</span>));</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (BufferedImage image : images) &#123;</span><br><span class="line">            ImageIO.write(image, <span class="string">&quot;jpg&quot;</span>, <span class="keyword">new</span> File(<span class="string">&quot;/data/opencv/frame/&quot;</span> + i + <span class="string">&quot;.jpg&quot;</span>));</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// grabAudioFromVideo(new File(&quot;/data/opencv/test.mp4&quot;), new File(&quot;/data/opencv/test.aac&quot;));</span></span><br><span class="line"></span><br><span class="line">        List&lt;File&gt; files = Lists.newArrayList(FileUtils.listFiles(<span class="keyword">new</span> File(<span class="string">&quot;/data/opencv/frame/&quot;</span>), <span class="keyword">new</span> String[]&#123;<span class="string">&quot;jpg&quot;</span>&#125;, <span class="keyword">false</span>));</span><br><span class="line">        Collections.sort(files, (o1, o2) -&gt; &#123;</span><br><span class="line">            <span class="keyword">int</span> i1 = NumberUtils.toInt(StringUtils.substringBefore(o1.getName(), <span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="keyword">int</span> i2 = NumberUtils.toInt(StringUtils.substringBefore(o2.getName(), <span class="string">&quot;.&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> Integer.compare(i1, i2);</span><br><span class="line">        &#125;);</span><br><span class="line">        record(<span class="string">&quot;/data/opencv/out.mp4&quot;</span>, files, <span class="keyword">new</span> File(<span class="string">&quot;/data/opencv/test.aac&quot;</span>), <span class="number">544</span>, <span class="number">960</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将多个图片文件合成视频</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> output    输出文件</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> images    序列帧图片</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> audioFile 音频</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> width     宽</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> height    高</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">record</span><span class="params">(String output, List&lt;File&gt; images, File audioFile, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (FFmpegFrameRecorder recorder = <span class="keyword">new</span> FFmpegFrameRecorder(output, width, height);</span><br><span class="line">             FFmpegFrameGrabber grabber = FFmpegFrameGrabber.createDefault(audioFile)) &#123;</span><br><span class="line">            recorder.setVideoCodec(avcodec.AV_CODEC_ID_H264);</span><br><span class="line">            recorder.setFormat(<span class="string">&quot;mp4&quot;</span>);</span><br><span class="line">            recorder.setFrameRate(<span class="number">30</span>);</span><br><span class="line">            recorder.setAudioBitrate(<span class="number">192000</span>);</span><br><span class="line">            recorder.setAudioQuality(<span class="number">0</span>);</span><br><span class="line">            recorder.setSampleRate(<span class="number">44100</span>);</span><br><span class="line">            recorder.setAudioChannels(<span class="number">2</span>);</span><br><span class="line">            recorder.start();</span><br><span class="line"></span><br><span class="line">            OpenCVFrameConverter.ToIplImage converter = <span class="keyword">new</span> OpenCVFrameConverter.ToIplImage();</span><br><span class="line">            <span class="keyword">for</span> (File file : images) &#123;</span><br><span class="line">                opencv_core.IplImage image = opencv_imgcodecs.cvLoadImage(file.getPath());</span><br><span class="line">                recorder.record(converter.convert(image));</span><br><span class="line">                opencv_core.cvReleaseImage(image);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            grabber.start();</span><br><span class="line">            Frame frame;</span><br><span class="line">            <span class="keyword">while</span> ((frame = grabber.grabSamples()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                recorder.setTimestamp(frame.timestamp);</span><br><span class="line">                recorder.recordSamples(frame.sampleRate, frame.audioChannels, frame.samples);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从视频中将每一帧的图片提取出来</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> video</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> FrameGrabber.Exception</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;BufferedImage&gt; <span class="title">grab</span><span class="params">(File video)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (FFmpegFrameGrabber grabber = FFmpegFrameGrabber.createDefault(video.getPath())) &#123;</span><br><span class="line">            grabber.start();</span><br><span class="line"></span><br><span class="line">            List&lt;BufferedImage&gt; images = Lists.newArrayList();</span><br><span class="line">            Frame frame;</span><br><span class="line">            <span class="keyword">while</span> ((frame = grabber.grabImage()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                images.add(Java2DFrameUtils.toBufferedImage(frame));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> images;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 从视频中提取出音频</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> video</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> outputAudio</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">grabAudioFromVideo</span><span class="params">(File video, File outputAudio)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> (FFmpegFrameGrabber grabber = FFmpegFrameGrabber.createDefault(video);</span><br><span class="line">             FFmpegFrameRecorder recorder = <span class="keyword">new</span> FFmpegFrameRecorder(outputAudio, <span class="number">1</span>)) &#123;</span><br><span class="line">            grabber.start();</span><br><span class="line">            recorder.setAudioCodec(avcodec.AV_CODEC_ID_AAC);</span><br><span class="line">            recorder.start();</span><br><span class="line"></span><br><span class="line">            Frame frame;</span><br><span class="line">            <span class="keyword">while</span> ((frame = grabber.grab()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (frame.audioChannels == <span class="number">1</span>) &#123;</span><br><span class="line">                    recorder.recordSamples(frame.sampleRate, frame.audioChannels, frame.samples);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="图片合成视频简单的封装"><a href="#图片合成视频简单的封装" class="headerlink" title="图片合成视频简单的封装"></a>图片合成视频简单的封装</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoRecorder</span> <span class="keyword">implements</span> <span class="title">Closeable</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> FFmpegFrameRecorder recorder;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">VideoRecorder</span><span class="params">(String output, <span class="keyword">int</span> width, <span class="keyword">int</span> height)</span> <span class="keyword">throws</span> FrameRecorder.Exception </span>&#123;</span><br><span class="line">            recorder = <span class="keyword">new</span> FFmpegFrameRecorder(output, width, height);</span><br><span class="line">            recorder.setVideoCodec(avcodec.AV_CODEC_ID_H264);</span><br><span class="line">            recorder.setFormat(<span class="string">&quot;mp4&quot;</span>);</span><br><span class="line">            recorder.setFrameRate(FPS);</span><br><span class="line">            recorder.setAudioBitrate(<span class="number">192000</span>);</span><br><span class="line">            recorder.setAudioQuality(<span class="number">0</span>);</span><br><span class="line">            recorder.setSampleRate(<span class="number">44100</span>);</span><br><span class="line">            recorder.setAudioChannels(<span class="number">2</span>);</span><br><span class="line">            recorder.start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addFrame</span><span class="params">(BufferedImage image)</span> <span class="keyword">throws</span> FrameRecorder.Exception </span>&#123;</span><br><span class="line">            Frame frame = Java2DFrameUtils.toFrame(image);</span><br><span class="line">            recorder.record(frame, avutil.AV_PIX_FMT_ARGB);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAudio</span><span class="params">(File audioFile)</span> <span class="keyword">throws</span> FrameGrabber.Exception, FrameRecorder.Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (audioFile == <span class="keyword">null</span> || !audioFile.exists()) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> (FFmpegFrameGrabber grabber = FFmpegFrameGrabber.createDefault(audioFile)) &#123;</span><br><span class="line">                grabber.start();</span><br><span class="line">                Frame frame;</span><br><span class="line">                <span class="keyword">while</span> ((frame = grabber.grabSamples()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    recorder.recordSamples(frame.sampleRate, frame.audioChannels, frame.samples);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">            recorder.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="解决maven打包时将不必要的包引入进来的问题"><a href="#解决maven打包时将不必要的包引入进来的问题" class="headerlink" title="解决maven打包时将不必要的包引入进来的问题"></a>解决maven打包时将不必要的包引入进来的问题</h2><p>我在实际使用中只用到了<code>ffmpeg</code>，但是打包的时候却将flycapture、libdc1394、libfreenect、artoolkitplus、tesseract…等包都打进来了，这些都是我不需要的，下面贴出我的maven配置示例。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javacpp.version</span>&gt;</span>1.4.2<span class="tag">&lt;/<span class="name">javacpp.version</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 这里要根据自己的平台选择不同的依赖 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;javacpp.platform.dependencies&gt;linux-x86_64&lt;/javacpp.platform.dependencies&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">javacpp.platform.dependencies</span>&gt;</span>macosx-x86_64<span class="tag">&lt;/<span class="name">javacpp.platform.dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;javacpp.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco.javacpp-presets<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>*<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco.javacpp-presets<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>opencv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.2-$&#123;javacpp.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco.javacpp-presets<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ffmpeg<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1-$&#123;javacpp.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco.javacpp-presets<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ffmpeg<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.1-$&#123;javacpp.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">classifier</span>&gt;</span>$&#123;javacpp.platform.dependencies&#125;<span class="tag">&lt;/<span class="name">classifier</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-08-11T17:53:46.000Z" title="8/11/2018, 5:53:46 PM">2018-08-11</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">5 分钟读完 (大约761个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/11/%E6%94%B6%E8%97%8F%E4%B8%A4%E9%A6%96%E7%A8%8B%E5%BA%8F%E5%91%98%E6%89%93%E6%B2%B9%E8%AF%97/">收藏两首程序员打油诗</a></h1><div class="content"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">商女不知亡国恨，一天到晚敲代码。</span><br><span class="line">举头望明月，低头敲代码。</span><br><span class="line">洛阳亲友如相问，就说我在敲代码。</span><br><span class="line">少壮不努力，老大敲代码。</span><br><span class="line">垂死病中惊坐起，今天还没敲代码。</span><br><span class="line">生当作人杰，死亦敲代码。</span><br><span class="line">人生自古谁无死，来生继续敲代码。</span><br><span class="line">众里寻他千百度，蓦然回首，那人正在敲代码。</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">写字楼里写字间，写字间里程序员；程序人员写程序，又拿程序换酒钱。</span><br><span class="line">酒醒只在网上坐，酒醉还来网下眠；酒醉酒醒日复日，网上网下年复年。</span><br><span class="line">宁愿老死程序间，只要老板多发钱；小车大房不去想，撰个二千好过年。</span><br><span class="line">若要见识新世面，公务员比程序员；一个在天一在地，而且还比我们闲。</span><br><span class="line">别人看我穿白领，我看别人穿名牌；天生我才写程序，臀大近视肩周炎。</span><br><span class="line"></span><br><span class="line">年复一年春光度，度得他人做老板；老板扣我薄酒钱，没有酒钱怎过年。</span><br><span class="line">春光逝去皱纹起，作起程序也委靡；来到水源把水灌，打死不做程序员。</span><br><span class="line">别人笑我忒疯癫，我笑他人命太贱；状元三百六十行，偏偏来做程序员。</span><br><span class="line">但愿老死电脑间，不愿鞠躬老板前；奔驰宝马贵者趣，公交自行程序员。</span><br><span class="line">别人笑我忒疯癫，我笑自己命太贱；不见满街漂亮妹，哪个归得程序员。</span><br><span class="line"></span><br><span class="line">不想只挣打工钱，那个老板愿发钱；小车大房咱要想，任我享用多悠闲。</span><br><span class="line">比尔能搞个微软，我咋不能捞点钱；一个在天一在地，定有一日乾坤翻。</span><br><span class="line">我在天来他在地，纵横天下山水间；傲视武林豪杰墓，一樽还垒风月山。</span><br><span class="line">电脑面前眼发直，眼镜下面泪茫茫；做梦发财好几亿，从此不用手指忙。</span><br><span class="line">哪知梦醒手空空，老板看到把我训；待到老时眼发花，走路不知哪是家。</span><br><span class="line"></span><br><span class="line">小农村里小民房，小民房里小民工；小民工人写程序，又拿代码讨赏钱。</span><br><span class="line">钱空只在代码中，钱醉仍在代码间；有钱无钱日复日，码上码下年复年。</span><br><span class="line">但愿老死代码间，不愿鞠躬奥迪前，奥迪奔驰贵者趣，程序代码贫者缘。</span><br><span class="line">若将贫贱比贫者，一在平地一在天；若将贫贱比车马，他得驱驰我得闲。</span><br><span class="line">别人笑我忒疯癫，我笑他人看不穿；不见盖茨两手间，财权富贵世人鉴。</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-08-09T14:47:52.000Z" title="8/9/2018, 2:47:52 PM">2018-08-09</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">4 分钟读完 (大约528个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/09/DelayQueue%E4%BD%BF%E7%94%A8/">DelayQueue使用</a></h1><div class="content"><h2 id="DelayQueue特性"><a href="#DelayQueue特性" class="headerlink" title="DelayQueue特性"></a>DelayQueue特性</h2><ul>
<li>队列中的元素都必须实现Delayed，元素可以指定延迟消费时长。</li>
<li>实现了BlockingQueue接口，所以他是一个阻塞队列。</li>
<li>本质上是基于PriorityQueue实现的。</li>
</ul>
<h2 id="贴一段我在实际生产环境中使用到代码"><a href="#贴一段我在实际生产环境中使用到代码" class="headerlink" title="贴一段我在实际生产环境中使用到代码"></a>贴一段我在实际生产环境中使用到代码</h2><h3 id="队列管理"><a href="#队列管理" class="headerlink" title="队列管理"></a>队列管理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.DelayQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Gao Youbo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018-07-26 19:53</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayQueueManager</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger LOG = LoggerFactory.getLogger(DelayQueueManager.class);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> ExecutorService executor;</span><br><span class="line">    <span class="keyword">private</span> Thread monitorThread;</span><br><span class="line">    <span class="keyword">private</span> DelayQueue&lt;DelayTask&lt;?&gt;&gt; delayQueue; <span class="comment">// 延时队列</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DelayQueueManager</span><span class="params">(String name, <span class="keyword">int</span> poolSize)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.executor = Executors.newFixedThreadPool(poolSize);</span><br><span class="line">        <span class="keyword">this</span>.delayQueue = <span class="keyword">new</span> DelayQueue&lt;&gt;();</span><br><span class="line">        init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 初始化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        monitorThread = <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            execute();</span><br><span class="line">        &#125;, <span class="string">&quot;DelayQueueMonitor-&quot;</span> + name);</span><br><span class="line">        monitorThread.start();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            LOG.info(<span class="string">&quot;当前延时任务数量:&quot;</span> + delayQueue.size());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 从延时队列中获取任务</span></span><br><span class="line">                DelayTask&lt;?&gt; delayTask = delayQueue.take();</span><br><span class="line">                <span class="keyword">if</span> (delayTask != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    Runnable task = delayTask.getTask();</span><br><span class="line">                    <span class="keyword">if</span> (task != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        <span class="comment">// 提交到线程池执行task</span></span><br><span class="line">                        executor.execute(task);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                LOG.error(<span class="keyword">null</span>, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加任务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id   任务编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task 任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 延时时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit 时间单位</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String id, Runnable task, <span class="keyword">long</span> time, TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> timeout = TimeUnit.MILLISECONDS.convert(time, unit);</span><br><span class="line">        <span class="keyword">long</span> delayTimeMillis = System.currentTimeMillis() + timeout;</span><br><span class="line">        delayQueue.put(<span class="keyword">new</span> DelayTask&lt;&gt;(id, delayTimeMillis, task));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 添加任务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id              任务编号</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task            任务</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delayTimeMillis 延迟到什么时间点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putAt</span><span class="params">(String id, Runnable task, <span class="keyword">long</span> delayTimeMillis)</span> </span>&#123;</span><br><span class="line">        delayQueue.put(<span class="keyword">new</span> DelayTask&lt;&gt;(id, delayTimeMillis, task));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据任务编号删除任务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> id</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeTaskById</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">        DelayTask task = <span class="keyword">new</span> DelayTask(id, <span class="number">0</span>, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> delayQueue.remove(task);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除任务</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> task</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">removeTask</span><span class="params">(DelayTask task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> delayQueue.remove(task);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="延迟任务对象"><a href="#延迟任务对象" class="headerlink" title="延迟任务对象"></a>延迟任务对象</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Delayed;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Gao Youbo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2018-07-26 19:54</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DelayTask</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">Runnable</span>&gt; <span class="keyword">implements</span> <span class="title">Delayed</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> delayTimeMillis; <span class="comment">// 延迟到什么时间点执行</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> T task; <span class="comment">// 任务</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DelayTask</span><span class="params">(String id, <span class="keyword">long</span> delayTimeMillis, T task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.delayTimeMillis = delayTimeMillis;</span><br><span class="line">        <span class="keyword">this</span>.task = task;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getTask</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> task;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed o)</span> </span>&#123;</span><br><span class="line">        DelayTask other = (DelayTask) o;</span><br><span class="line">        <span class="keyword">long</span> diff = delayTimeMillis - other.delayTimeMillis;</span><br><span class="line">        <span class="keyword">if</span> (diff &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (diff &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unit.convert(<span class="keyword">this</span>.delayTimeMillis - System.currentTimeMillis(), TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span> == o) <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        DelayTask&lt;?&gt; delayTask = (DelayTask&lt;?&gt;) o;</span><br><span class="line">        <span class="keyword">return</span> Objects.equals(id, delayTask.id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-08-07T11:15:51.000Z" title="8/7/2018, 11:15:51 AM">2018-08-07</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约109个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/07/hexo-client-1-1-3%E6%9B%B4%E6%96%B0/">hexo-client 1.1.3更新</a></h1><div class="content"><ul>
<li>升级markdown编辑器，使用mavonEditor编辑器（<a target="_blank" rel="noopener" href="https://github.com/hinesboy/mavonEditor%EF%BC%89%E3%80%82">https://github.com/hinesboy/mavonEditor）。</a></li>
<li>修复图片文章列表过长是，切换页面滚动位置丢失的问题。</li>
<li>重构代码，优化调用逻辑和布局层级关系。</li>
<li>升级electron版本到2.0.6。</li>
</ul>
<p>mac版本下载地址：<a target="_blank" rel="noopener" href="https://pan.baidu.com/s/1VuJIOoltpsTwnurn9aVQXw">https://pan.baidu.com/s/1VuJIOoltpsTwnurn9aVQXw</a></p>
<p><img src="http://file.mspring.org/images/blog/8b299e7bad6e69b7612cdee592019bf9!detail"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-08-07T10:42:10.000Z" title="8/7/2018, 10:42:10 AM">2018-08-07</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约96个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/08/07/npm%E5%8F%91%E5%B8%83%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8C%85/">npm发布自己的包</a></h1><div class="content"><ol>
<li>如果没有账号，那么使用<code>npm adduser</code>去创建账号，中间会引导你输入用户名、密码、邮箱。</li>
<li>如果已经有账号，需要使用<code>npm login</code>去登录，同样会引导你输入正确的用户名、密码、邮箱。</li>
<li>登录成功之后使用<code>npm publish</code>将自己的包发不上去。</li>
</ol>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-05-11T18:20:37.000Z" title="5/11/2018, 6:20:37 PM">2018-05-11</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">1 分钟读完 (大约153个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/05/11/ffmpeg%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/">ffmpeg常用命令总结</a></h1><div class="content"><h2 id="音频格式转换"><a href="#音频格式转换" class="headerlink" title="音频格式转换"></a>音频格式转换</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -y  -i aidemo.mp3  -acodec pcm_s16le -f s16le -ac 1 -ar 16000 16k.pcm </span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; -acodec pcm_s16le pcm_s16le 16bits 编码器 </span><br><span class="line">&#x2F;&#x2F; -f s16le 保存为16bits pcm格式</span><br><span class="line">&#x2F;&#x2F; -ac 1 单声道</span><br><span class="line">&#x2F;&#x2F;  -ar 16000  16000采样率</span><br></pre></td></tr></table></figure>

<h2 id="查看音频格式"><a href="#查看音频格式" class="headerlink" title="查看音频格式"></a>查看音频格式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">ffprobe -v quiet -print_format json -show_streams  aidemo.mp3</span><br><span class="line"></span><br><span class="line">输出如下：</span><br><span class="line"> &#123;</span><br><span class="line">    &quot;streams&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;index&quot;: 0,</span><br><span class="line">            &quot;codec_name&quot;: &quot;mp3&quot;, &#x2F;&#x2F; mp3 格式</span><br><span class="line">            &quot;codec_long_name&quot;: &quot;MP3 (MPEG audio layer 3)&quot;,</span><br><span class="line">            &quot;codec_type&quot;: &quot;audio&quot;,</span><br><span class="line">            &quot;codec_time_base&quot;: &quot;1&#x2F;16000&quot;, </span><br><span class="line">            &quot;codec_tag_string&quot;: &quot;[0][0][0][0]&quot;,</span><br><span class="line">            &quot;codec_tag&quot;: &quot;0x0000&quot;,</span><br><span class="line">            &quot;sample_fmt&quot;: &quot;s16p&quot;, </span><br><span class="line">            &quot;sample_rate&quot;: &quot;16000&quot;, &#x2F;&#x2F; 16000采样率</span><br><span class="line">            &quot;channels&quot;: 1, &#x2F;&#x2F; 单声道</span><br><span class="line">            &quot;channel_layout&quot;: &quot;mono&quot;,</span><br><span class="line">            &quot;bits_per_sample&quot;: 0,</span><br><span class="line">            &quot;r_frame_rate&quot;: &quot;0&#x2F;0&quot;,</span><br><span class="line">            &quot;avg_frame_rate&quot;: &quot;0&#x2F;0&quot;,</span><br><span class="line">            &quot;time_base&quot;: &quot;1&#x2F;14112000&quot;,</span><br><span class="line">            &quot;start_pts&quot;: 0,</span><br><span class="line">            &quot;start_time&quot;: &quot;0.000000&quot;,</span><br><span class="line">            &quot;duration_ts&quot;: 259096320,</span><br><span class="line">            &quot;duration&quot;: &quot;18.360000&quot;,</span><br><span class="line">            &quot;bit_rate&quot;: &quot;16000&quot;,</span><br><span class="line">            &quot;disposition&quot;: &#123;</span><br><span class="line">                &quot;default&quot;: 0,</span><br><span class="line">                &quot;dub&quot;: 0,</span><br><span class="line">                &quot;original&quot;: 0,</span><br><span class="line">                &quot;comment&quot;: 0,</span><br><span class="line">                &quot;lyrics&quot;: 0,</span><br><span class="line">                &quot;karaoke&quot;: 0,</span><br><span class="line">                &quot;forced&quot;: 0,</span><br><span class="line">                &quot;hearing_impaired&quot;: 0,</span><br><span class="line">                &quot;visual_impaired&quot;: 0,</span><br><span class="line">                &quot;clean_effects&quot;: 0,</span><br><span class="line">                &quot;attached_pic&quot;: 0,</span><br><span class="line">                &quot;timed_thumbnails&quot;: 0</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-05-09T09:49:37.000Z" title="5/9/2018, 9:49:37 AM">2018-05-09</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约82个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/05/09/Guava-Range%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">Guava Range使用方法</a></h1><div class="content"><table>
<thead>
<tr>
<th><strong>概念</strong></th>
<th><strong>表示范围</strong></th>
<th><strong>guava对应功能方法</strong></th>
</tr>
</thead>
<tbody><tr>
<td>(a..b)</td>
<td>{x &#124; a &lt; x &lt; b}</td>
<td>open(C, C)</td>
</tr>
<tr>
<td>[a..b]</td>
<td>{x &#124; a &lt;= x &lt;= b}</td>
<td>closed(C, C)</td>
</tr>
<tr>
<td>[a..b)</td>
<td>{x &#124; a &lt;= x &lt; b}</td>
<td>closedOpen(C, C)</td>
</tr>
<tr>
<td>(a..b]</td>
<td>{x &#124; a &lt; x &lt;= b}</td>
<td>openClosed(C, C)</td>
</tr>
<tr>
<td>(a..+∞)</td>
<td>{x &#124; x &gt; a}</td>
<td>greaterThan(C)</td>
</tr>
<tr>
<td>[a..+∞)</td>
<td>{x &#124; x &gt;= a}</td>
<td>atLeast(C)</td>
</tr>
<tr>
<td>(-∞..b)</td>
<td>{x &#124; x &lt; b}</td>
<td>lessThan(C)</td>
</tr>
<tr>
<td>(-∞..b]</td>
<td>{x &#124; x &lt;= b}</td>
<td>atMost(C)</td>
</tr>
<tr>
<td>(-∞..+∞)</td>
<td>all values</td>
<td>all()</td>
</tr>
</tbody></table>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-04-27T10:07:13.000Z" title="4/27/2018, 10:07:13 AM">2018-04-27</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">8 分钟读完 (大约1236个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/04/27/%E5%BE%AE%E4%BF%A1%E7%BA%A2%E5%8C%85%E7%9A%84%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E7%AE%80%E4%BB%8B/">微信红包的架构设计简介</a></h1><div class="content"><p>转载自：<a target="_blank" rel="noopener" href="http://colobu.com/2015/05/04/weixin-red-packets-design-discussion/">http://colobu.com/2015/05/04/weixin-red-packets-design-discussion/</a></p>
<p>背景：有某个朋友在朋友圈咨询微信红包的架构，于是乎有了下面的文字（有误请提出，谢谢）<br>概况：2014年微信红包使用数据库硬抗整个流量，2015年使用cache抗流量。</p>
<h3 id="微信的金额什么时候算？"><a href="#微信的金额什么时候算？" class="headerlink" title="微信的金额什么时候算？"></a>微信的金额什么时候算？</h3><p>答：微信金额是拆的时候实时算出来，不是预先分配的，采用的是纯内存计算，不需要预算空间存储。<br>采取实时计算金额的考虑：预算需要占存储，实时效率很高，预算才效率低。</p>
<h3 id="实时性：为什么明明抢到红包，点开后发现没有？"><a href="#实时性：为什么明明抢到红包，点开后发现没有？" class="headerlink" title="实时性：为什么明明抢到红包，点开后发现没有？"></a>实时性：为什么明明抢到红包，点开后发现没有？</h3><p>答：2014年的红包一点开就知道金额，分两次操作，先抢到金额，然后再转账。<br>2015年的红包的拆和抢是分离的，需要点两次，因此会出现抢到红包了，但点开后告知红包已经被领完的状况。进入到第一个页面不代表抢到，只表示当时红包还有。</p>
<h3 id="分配：红包里的金额怎么算？为什么出现各个红包金额相差很大？"><a href="#分配：红包里的金额怎么算？为什么出现各个红包金额相差很大？" class="headerlink" title="分配：红包里的金额怎么算？为什么出现各个红包金额相差很大？"></a>分配：红包里的金额怎么算？为什么出现各个红包金额相差很大？</h3><p>答：随机，额度在0.01和剩余平均值 * 2之间。 例如：发100块钱，总共10个红包，那么平均值是10块钱一个，那么发出来的红包的额度在0.01元～20元之间波动。<br>当前面3个红包总共被领了40块钱时，剩下60块钱，总共7个红包，那么这7个红包的额度在：0.01～（60/7 * 2）=17.14之间。<br>注意：这里的算法是每被抢一个后，剩下的会再次执行上面的这样的算法（Tim老师也觉得上述算法太复杂，不知基于什么样的考虑）。</p>
<blockquote>
<p>这样算下去，会超过最开始的全部金额，因此到了最后面如果不够这么算，那么会采取如下算法：保证剩余用户能拿到最低1分钱即可。<br>如果前面的人手气不好，那么后面的余额越多，红包额度也就越多，因此实际概率一样的。</p>
</blockquote>
<h3 id="红包的设计"><a href="#红包的设计" class="headerlink" title="红包的设计"></a>红包的设计</h3><p>答：微信从财付通拉取金额数据过来，生成个数/红包类型/金额放到redis集群里，app端将红包ID的请求放入请求队列中，如果发现超过红包的个数，直接返回。根据红包的逻辑处理成功得到令牌请求，则由财付通进行一致性调用，通过像比特币一样，两边保存交易记录，交易后交给第三方服务审计，如果交易过程中出现不一致就强制回归。</p>
<h3 id="并发性处理：红包如何计算被抢完？"><a href="#并发性处理：红包如何计算被抢完？" class="headerlink" title="并发性处理：红包如何计算被抢完？"></a>并发性处理：红包如何计算被抢完？</h3><p>答：cache会抵抗无效请求，将无效的请求过滤掉，实际进入到后台的量不大。cache记录红包个数，原子操作进行个数递减，到0表示被抢光。财付通按照20万笔每秒入账准备，但实际还不到8万每秒。</p>
<h3 id="通如何保持8w每秒的写入？"><a href="#通如何保持8w每秒的写入？" class="headerlink" title="通如何保持8w每秒的写入？"></a>通如何保持8w每秒的写入？</h3><p>答：多主sharding，水平扩展机器。</p>
<h3 id="数据容量多少？"><a href="#数据容量多少？" class="headerlink" title="数据容量多少？"></a>数据容量多少？</h3><p>答：一个红包只占一条记录，有效期只有几天，因此不需要太多空间。</p>
<h3 id="查询红包分配，压力大不？"><a href="#查询红包分配，压力大不？" class="headerlink" title="查询红包分配，压力大不？"></a>查询红包分配，压力大不？</h3><p>答：抢到红包的人数和红包都在一条cache记录上，没有太大的查询压力。</p>
<h3 id="一个红包一个队列？"><a href="#一个红包一个队列？" class="headerlink" title="一个红包一个队列？"></a>一个红包一个队列？</h3><p>答：没有队列，一个红包一条数据，数据上有一个计数器字段。</p>
<h3 id="有没有从数据上证明每个红包的概率是不是均等？"><a href="#有没有从数据上证明每个红包的概率是不是均等？" class="headerlink" title="有没有从数据上证明每个红包的概率是不是均等？"></a>有没有从数据上证明每个红包的概率是不是均等？</h3><p>答：不是绝对均等，就是一个简单的拍脑袋算法。</p>
<h3 id="拍脑袋算法，会不会出现两个最佳？"><a href="#拍脑袋算法，会不会出现两个最佳？" class="headerlink" title="拍脑袋算法，会不会出现两个最佳？"></a>拍脑袋算法，会不会出现两个最佳？</h3><p>答：会出现金额一样的，但是手气最佳只有一个，先抢到的那个最佳。</p>
<h3 id="每领一个红包就更新数据么？"><a href="#每领一个红包就更新数据么？" class="headerlink" title="每领一个红包就更新数据么？"></a>每领一个红包就更新数据么？</h3><p>答：每抢到一个红包，就cas更新剩余金额和红包个数。</p>
<h3 id="红包如何入库入账？"><a href="#红包如何入库入账？" class="headerlink" title="红包如何入库入账？"></a>红包如何入库入账？</h3><p>数据库会累加已经领取的个数与金额，插入一条领取记录。入账则是后台异步操作。</p>
<h3 id="入帐出错怎么办？比如红包个数没了，但余额还有？"><a href="#入帐出错怎么办？比如红包个数没了，但余额还有？" class="headerlink" title="入帐出错怎么办？比如红包个数没了，但余额还有？"></a>入帐出错怎么办？比如红包个数没了，但余额还有？</h3><p>答：最后会有一个take all操作。另外还有一个对账来保障。</p>
<p>下面这张图是@周帆 同学的杰作！<br><img src="http://file.mspring.org/images/blog/29b9b3e981a63d78318a4d4ad472e71a"></p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-04-10T20:23:49.000Z" title="4/10/2018, 8:23:49 PM">2018-04-10</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约31个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/04/10/%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%8E%A8%E9%80%81Jar%E5%8C%85%E5%88%B0nexus/">命令行推送Jar包到nexus</a></h1><div class="content"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy:deploy-file -DgroupId&#x3D;com.tencent -DartifactId&#x3D;xinge -Dversion&#x3D;1.1.8 -Dpackaging&#x3D;jar -DrepositoryId&#x3D;nexus -Dfile&#x3D;&#x2F;Users&#x2F;gaoyoubo&#x2F;xinge-push.jar -Durl&#x3D;http:&#x2F;&#x2F;xxx.xxx.com:8081&#x2F;nexus&#x2F;content&#x2F;repositories&#x2F;thirdparty&#x2F; -DgeneratePom&#x3D;false</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2018-03-31T13:56:30.000Z" title="3/31/2018, 1:56:30 PM">2018-03-31</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">8 分钟读完 (大约1127个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2018/03/31/%E5%B9%B6%E5%8F%91%E9%98%9F%E5%88%97-%E6%97%A0%E7%95%8C%E9%98%BB%E5%A1%9E%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97DelayQueue%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6/">并发队列-无界阻塞延迟队列DelayQueue原理探究</a></h1><div class="content"><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">转载自：http:&#x2F;&#x2F;ifeve.com&#x2F;%E5%B9%B6%E5%8F%91%E9%98%9F%E5%88%97-%E6%97%A0%E7%95%8C%E9%98%BB%E5%A1%9E%E5%BB%B6%E8%BF%9F%E9%98%9F%E5%88%97delayqueue%E5%8E%9F%E7%90%86%E6%8E%A2%E7%A9%B6&#x2F;</span><br><span class="line">最近在开发中正好有类似场景。</span><br></pre></td></tr></table></figure>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>DelayQueue队列中每个元素都有个过期时间，并且队列是个优先级队列，当从队列获取元素时候，只有过期元素才会出队列。</p>
<h2 id="DelayQueue类图结构"><a href="#DelayQueue类图结构" class="headerlink" title="DelayQueue类图结构"></a>DelayQueue类图结构</h2><p><img src="http://file.mspring.org/images/blog/2346ca43fe3c972b6bb4beab5edf1328"></p>
<p>如图DelayQueue中内部使用的是PriorityQueue存放数据，使用ReentrantLock实现线程同步，可知是阻塞队列。另外队列里面的元素要实现Delayed接口，一个是获取当前剩余时间的接口，一个是元素比较的接口，因为这个是有优先级的队列。</p>
<h2 id="offer操作"><a href="#offer操作" class="headerlink" title="offer操作"></a>offer操作</h2><p>插入元素到队列，主要插入元素要实现Delayed接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">offer</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        q.offer(e);</span><br><span class="line">        <span class="keyword">if</span> (q.peek() == e) &#123;（<span class="number">2</span>）</span><br><span class="line">            leader = <span class="keyword">null</span>;</span><br><span class="line">            available.signal();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>首先获取独占锁，然后添加元素到优先级队列，由于q是优先级队列，所以添加元素后，peek并不一定是当前添加的元素，如果（2）为true，说明当前元素e的优先级最小也就即将过期的，这时候激活avaliable变量条件队列里面的线程，通知他们队列里面有元素了。</p>
<h2 id="take操作"><a href="#take操作" class="headerlink" title="take操作"></a>take操作</h2><p>获取并移除队列首元素，如果队列没有过期元素则等待。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">take</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">                <span class="comment">//获取但不移除队首元素（1)</span></span><br><span class="line">                E first = q.peek();</span><br><span class="line">                <span class="keyword">if</span> (first == <span class="keyword">null</span>)</span><br><span class="line">                    available.await();<span class="comment">//(2)</span></span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">long</span> delay = first.getDelay(TimeUnit.NANOSECONDS);</span><br><span class="line">                    <span class="keyword">if</span> (delay &lt;= <span class="number">0</span>)<span class="comment">//(3)</span></span><br><span class="line">                        <span class="keyword">return</span> q.poll();</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span> (leader != <span class="keyword">null</span>)<span class="comment">//(4)</span></span><br><span class="line">                        available.await();</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        Thread thisThread = Thread.currentThread();</span><br><span class="line">                        leader = thisThread;<span class="comment">//(5)</span></span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            available.awaitNanos(delay);</span><br><span class="line">                        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (leader == thisThread)</span><br><span class="line">                                leader = <span class="keyword">null</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (leader == <span class="keyword">null</span> &amp;&amp; q.peek() != <span class="keyword">null</span>)<span class="comment">//(6)</span></span><br><span class="line">                available.signal();</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>第一次调用take时候由于队列空，所以调用（2）把当前线程放入available的条件队列等待，当执行offer并且添加的元素就是队首元素时候就会通知最先等待的线程激活，循环重新获取队首元素，这时候first假如不空，则调用getdelay方法看该元素海剩下多少时间就过期了，如果delay&lt;=0则说明已经过期，则直接出队返回。否者看leader是否为null，不为null则说明是其他线程也在执行take则把该线程放入条件队列，否者是当前线程执行的take方法，则调用(5)await直到剩余过期时间到（这期间该线程会释放锁，所以其他线程可以offer添加元素，也可以take阻塞自己），剩余过期时间到后，该线程会重新竞争得到锁，重新进入循环。</p>
<p>（6）说明当前take返回了元素，如果当前队列还有元素则调用singal激活条件队列里面可能有的等待线程。leader那么为null，那么是第一次调用take获取过期元素的线程，第一次调用的线程调用设置等待时间的await方法等待数据过期，后面调用take的线程则调用await直到signal。</p>
<h2 id="poll操作"><a href="#poll操作" class="headerlink" title="poll操作"></a>poll操作</h2><p>获取并移除队头过期元素，否者返回null</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> E <span class="title">poll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">this</span>.lock;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        E first = q.peek();</span><br><span class="line">        <span class="comment">//如果队列为空，或者不为空但是队头元素没有过期则返回null</span></span><br><span class="line">        <span class="keyword">if</span> (first == <span class="keyword">null</span> || first.getDelay(TimeUnit.NANOSECONDS) &gt; <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> q.poll();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DelayedEle</span> <span class="keyword">implements</span> <span class="title">Delayed</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> delayTime; <span class="comment">//延迟时间</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">long</span> expire;  <span class="comment">//到期时间</span></span><br><span class="line">    <span class="keyword">private</span> String data;   <span class="comment">//数据</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DelayedEle</span><span class="params">(<span class="keyword">long</span> delay, String data)</span> </span>&#123;</span><br><span class="line">        delayTime = delay;</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">        expire = System.currentTimeMillis() + delay; </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 剩余时间=到期时间-当前时间</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getDelay</span><span class="params">(TimeUnit unit)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> unit.convert(<span class="keyword">this</span>.expire - System.currentTimeMillis() , TimeUnit.MILLISECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 优先队列里面优先级规则</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(Delayed o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>) (<span class="keyword">this</span>.getDelay(TimeUnit.MILLISECONDS) -o.getDelay(TimeUnit.MILLISECONDS));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> StringBuilder sb = <span class="keyword">new</span> StringBuilder(<span class="string">&quot;DelayedElement&#123;&quot;</span>);</span><br><span class="line">        sb.append(<span class="string">&quot;delay=&quot;</span>).append(delayTime);</span><br><span class="line">        sb.append(<span class="string">&quot;, expire=&quot;</span>).append(expire);</span><br><span class="line">        sb.append(<span class="string">&quot;, data=&#x27;&quot;</span>).append(data).append(<span class="string">&#x27;\&#x27;&#x27;</span>);</span><br><span class="line">        sb.append(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    DelayQueue&lt;DelayedEle&gt; delayQueue = <span class="keyword">new</span> DelayQueue&lt;DelayedEle&gt;();</span><br><span class="line"></span><br><span class="line">    DelayedEle element1 = <span class="keyword">new</span> DelayedEle(<span class="number">1000</span>,<span class="string">&quot;zlx&quot;</span>);</span><br><span class="line">    DelayedEle element2 = <span class="keyword">new</span> DelayedEle(<span class="number">1000</span>,<span class="string">&quot;gh&quot;</span>);</span><br><span class="line"></span><br><span class="line">    delayQueue.offer(element1);</span><br><span class="line">    delayQueue.offer(element2);</span><br><span class="line"></span><br><span class="line">    element1 =  delayQueue.take();</span><br><span class="line">    System.out.println(element1);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h2><p>TimerQueue的内部实现<br>ScheduledThreadPoolExecutor中DelayedWorkQueue是对其的优化使用</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-09-05T18:15:00.000Z" title="9/5/2017, 6:15:00 PM">2017-09-05</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"> 雾非雾的情思 </span><span class="level-item">几秒读完 (大约49个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/09/05/Git%E4%BF%AE%E6%94%B9%E9%BB%98%E8%AE%A4%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%BAVIM/">Git修改默认编辑器为VIM</a></h1><div class="content"><p>重做系统了，新安装的Git默认编辑器为nano，各种不习惯，可以通过一下方式将默认编辑器修改为Vim</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.editor vim</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-03-27T00:00:00.000Z" title="3/27/2017, 12:00:00 AM">2017-03-27</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">几秒读完 (大约70个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/03/27/maven%E6%89%93%E5%8C%85%E5%8F%AF%E6%89%A7%E8%A1%8Cjar%E6%96%87%E4%BB%B6/">maven打包可执行jar文件</a></h1><div class="content"><p>需要打包有依赖第三方jar包的可执行jar会用到，他会帮你将所有的第三方的jar包都打到同一个jar中，这样就不用手动去设置classpath</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-shade-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>shade<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">transformers</span>&gt;</span></span><br><span class="line">                            &lt;transformer</span><br><span class="line">                                    implementation=&quot;org.apache.maven.plugins.shade.resource.ManifestResourceTransformer&quot;&gt;</span><br><span class="line">                                <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>cn.mucang.saturn.transfer.Transfer<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;/<span class="name">transformer</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">transformers</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2017-03-19T00:00:00.000Z" title="3/19/2017, 12:00:00 AM">2017-03-19</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item">2 分钟读完 (大约361个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2017/03/19/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E7%9C%8B%E6%87%82when-js/">一篇文章看懂when.js</a></h1><div class="content"><blockquote>
<p>最近在拾起很久都没做过的前端，总结下When.js的最常用的场景。</p>
</blockquote>
<h3 id="场景1"><a href="#场景1" class="headerlink" title="场景1"></a>场景1</h3><p>执行异步function a，当成功时执行function b，失败时执行function c，执行过程中需要回调function d来监控执行状态。</p>
<p>这个是最通用的用法，也是when.js中最长用到的，示例代码如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> deferred = when.defer()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        deferred.notify(i++);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        deferred.reject(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    deferred.resolve(<span class="string">&#x27;成功消息&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a().then(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params">msg</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;执行成功&#x27;</span>)</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;执行失败&#x27;</span>)</span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span> <span class="title">d</span>(<span class="params">i</span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;执行中...&#x27;</span> + i)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>总结：then有三个参数，分别是onFulfilled、onRejected、onProgress，通过这三个参数，就可以指定上一个任务在resolve、reject和notify时该如何处理。例如上一个任务被resolve(data)，onFulfilled函数就会被触发，data作为它的参数；被reject(reason)，那么onRejected就会被触发，收到reason。任何时候，onFulfilled和onRejected都只有其一可以被触发，并且只触发一次；onProgress顾名思义，每次notify时都会被调用。</p>
<h3 id="场景2"><a href="#场景2" class="headerlink" title="场景2"></a>场景2</h3><p>执行完function a，再执行function b；执行完function b，在执行function c。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> deferred = when.defer()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        deferred.notify(i++);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">        deferred.reject(e)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    deferred.resolve(<span class="string">&#x27;成功消息&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">a().then(<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;&#125;).then(<span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;)</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2016-04-20T00:00:00.000Z" title="4/20/2016, 12:00:00 AM">2016-04-20</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.731Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"> 雾非雾的情思 </span><span class="level-item">5 分钟读完 (大约693个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/04/20/nginx-clojure%E5%AE%89%E8%A3%85%E4%BD%BF%E7%94%A8/">nginx-clojure安装使用</a></h1><div class="content"><h2 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h2><h3 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h3><pre><code>jdk1.6+
nginx1.4+
</code></pre>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>下载nginx和nginx-clojure源码，分别去他们的官网下载就可以，然后将他们解压、编译、安装。编译安装nginx时，加上nginx-clojure模块，具体安装脚本如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx --add-module=nginx-clojure模块解压路径</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><pre><code>### 建议这里查看官方文档，比较详细
### 官方文档地址：http://nginx-clojure.github.io/configuration.html#21-jvm-path--class-path--other-jvm-options
jvm_path auto;
# classpath：需要加载nginx-clojure自己的jar包，并加载自己开发的jar包
jvm_classpath &quot;/usr/local/nginx/libs/nginx-clojure-0.4.4/jars/*:/Users/gaoyoubo/work/dianping-service/dianping-nginx/target/dianping-nginx-2.0.1-SNAPSHOT.jar&quot;;
</code></pre>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="rewrite-handler"><a href="#rewrite-handler" class="headerlink" title="rewrite handler"></a>rewrite handler</h3><blockquote>
<p>rewrite handler可用于请求的转发。</p>
</blockquote>
<h4 id="Java-handler类"><a href="#Java-handler类" class="headerlink" title="Java handler类"></a>Java handler类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> my.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> nginx.clojure.java.Constants.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRewriteProxyPassHandler</span> <span class="keyword">implements</span> <span class="title">NginxJavaRingHandler</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Object[] invoke(Map&lt;String, Object&gt; req) &#123;</span><br><span class="line">		String myhost = computeMyHost(req);</span><br><span class="line">		((NginxJavaRequest)req).setNGXVariable(<span class="string">&quot;myhost&quot;</span>, myhost);</span><br><span class="line">		<span class="keyword">return</span> PHASE_DONE;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">private</span> String <span class="title">computeMyHost</span><span class="params">(Map&lt;String, Object&gt; req)</span> </span>&#123;</span><br><span class="line">		<span class="comment">//compute a upstream name or host name;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="nginx-conf配置"><a href="#nginx-conf配置" class="headerlink" title="nginx.conf配置"></a>nginx.conf配置</h4><pre><code>set $myhost &quot;&quot;;
location /myproxy &#123;
    ### 这里指定handle_type
    rewrite_handler_type &#39;java&#39;;
    ### 这里指定处理类
    rewrite_handler_name &#39;my.test.MyRewriteProxyPassHandler&#39;;
    proxy_pass $myhost;
&#125; 
</code></pre>
<h3 id="access-handler"><a href="#access-handler" class="headerlink" title="access handler"></a>access handler</h3><blockquote>
<p>可做请求的权限校验</p>
</blockquote>
<h4 id="Java-handler类-1"><a href="#Java-handler类-1" class="headerlink" title="Java handler类"></a>Java handler类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">     * This is an  example of HTTP basic Authentication.</span></span><br><span class="line"><span class="comment">     * It will require visitor to input a user name (xfeep) and password (hello!) </span></span><br><span class="line"><span class="comment">     * otherwise it will return 401 Unauthorized or BAD USER &amp; PASSWORD </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">BasicAuthHandler</span> <span class="keyword">implements</span> <span class="title">NginxJavaRingHandler</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Object[] invoke(Map&lt;String, Object&gt; request) &#123;</span><br><span class="line">            String auth = (String) ((Map)request.get(HEADERS)).get(<span class="string">&quot;authorization&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (auth == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Object[] &#123; <span class="number">401</span>, ArrayMap.create(<span class="string">&quot;www-authenticate&quot;</span>, <span class="string">&quot;Basic realm=\&quot;Secure Area\&quot;&quot;</span>),</span><br><span class="line">                        <span class="string">&quot;&lt;HTML&gt;&lt;BODY&gt;&lt;H1&gt;401 Unauthorized.&lt;/H1&gt;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span> &#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            String[] up = <span class="keyword">new</span> String(DatatypeConverter.parseBase64Binary(auth.substring(<span class="string">&quot;Basic &quot;</span>.length())), DEFAULT_ENCODING).split(<span class="string">&quot;:&quot;</span>);</span><br><span class="line">            <span class="keyword">if</span> (up[<span class="number">0</span>].equals(<span class="string">&quot;xfeep&quot;</span>) &amp;&amp; up[<span class="number">1</span>].equals(<span class="string">&quot;hello!&quot;</span>)) &#123;</span><br><span class="line">                <span class="keyword">return</span> PHASE_DONE;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Object[] &#123; <span class="number">401</span>, ArrayMap.create(<span class="string">&quot;www-authenticate&quot;</span>, <span class="string">&quot;Basic realm=\&quot;Secure Area\&quot;&quot;</span>),</span><br><span class="line">            <span class="string">&quot;&lt;HTML&gt;&lt;BODY&gt;&lt;H1&gt;401 Unauthorized BAD USER &amp; PASSWORD.&lt;/H1&gt;&lt;/BODY&gt;&lt;/HTML&gt;&quot;</span> &#125;;</span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="nginx-conf配置-1"><a href="#nginx-conf配置-1" class="headerlink" title="nginx.conf配置"></a>nginx.conf配置</h4><pre><code>location /basicAuth &#123;
    access_handler_type &#39;java&#39;;
    access_handler_name &#39;my.BasicAuthHandler&#39;;
    ....
&#125;
</code></pre>
<h3 id="header-filter"><a href="#header-filter" class="headerlink" title="header filter"></a>header filter</h3><blockquote>
<p>可拦截头信息，并作出相应的处理</p>
</blockquote>
<h4 id="Java-handler类-2"><a href="#Java-handler类-2" class="headerlink" title="Java handler类"></a>Java handler类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> my;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> nginx.clojure.java.NginxJavaRingHandler;</span><br><span class="line"><span class="keyword">import</span> nginx.clojure.java.Constants;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>  <span class="class"><span class="keyword">class</span> <span class="title">RemoveAndAddMoreHeaders</span> <span class="keyword">implements</span> <span class="title">NginxJavaHeaderFilter</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">public</span> Object[] doFilter(<span class="keyword">int</span> status, Map&lt;String, Object&gt; request, Map&lt;String, Object&gt; responseHeaders) &#123;</span><br><span class="line">		responseHeaders.remove(<span class="string">&quot;Content-Type&quot;</span>);</span><br><span class="line">		responseHeaders.put(<span class="string">&quot;Content-Type&quot;</span>, <span class="string">&quot;text/html&quot;</span>);</span><br><span class="line">		responseHeaders.put(<span class="string">&quot;Xfeep-Header&quot;</span>, <span class="string">&quot;Hello2!&quot;</span>);</span><br><span class="line">		responseHeaders.put(<span class="string">&quot;Server&quot;</span>, <span class="string">&quot;My-Test-Server&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> Constants.PHASE_DONE;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="nginx-conf配置-2"><a href="#nginx-conf配置-2" class="headerlink" title="nginx.conf配置"></a>nginx.conf配置</h4><pre><code>location /javafilter &#123;
    header_filter_type &#39;java&#39;;
    header_filter_name &#39;my.RemoveAndAddMoreHeaders &#39;;
    ..................
&#125;
</code></pre>
<h3 id="body-filter"><a href="#body-filter" class="headerlink" title="body filter"></a>body filter</h3><blockquote>
<p>可修改返回数据</p>
</blockquote>
<h4 id="Java-handler类-3"><a href="#Java-handler类-3" class="headerlink" title="Java handler类"></a>Java handler类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StringFacedUppercaseBodyFilter</span> <span class="keyword">extends</span> <span class="title">StringFacedJavaBodyFilter</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">		<span class="keyword">protected</span> Object[] doFilter(Map&lt;String, Object&gt; request, String body, <span class="keyword">boolean</span> isLast) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="keyword">if</span> (isLast) &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Object[] &#123;<span class="number">200</span>, <span class="keyword">null</span>, body.toUpperCase()&#125;;</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="keyword">new</span> Object[] &#123;<span class="keyword">null</span>, <span class="keyword">null</span>, body.toUpperCase()&#125;;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="nginx-conf配置-3"><a href="#nginx-conf配置-3" class="headerlink" title="nginx.conf配置"></a>nginx.conf配置</h4><pre><code>location /hello &#123;
  body_filter_type java;
  body_filter_name mytest.StringFacedUppercaseBodyFilter;
&#125;
</code></pre>
<h2 id="更多使用场景"><a href="#更多使用场景" class="headerlink" title="更多使用场景"></a>更多使用场景</h2><blockquote>
<p>nginx-clojure能够获取和修改请求数据、响应数据、header信息等（基本上java servlet中能够获取和修改的数据，他也都能获取和修改），所以基于他，我们能够完成很多servlet能够完成的数据，甚至他能够连接mysql，redis等。</p>
</blockquote>
<h3 id="可操作的请求数据"><a href="#可操作的请求数据" class="headerlink" title="可操作的请求数据"></a>可操作的请求数据</h3><pre><code>Server port
Server-name
Remote addr
Uri
Query String
Scheme
Request-method
Protocol
Content type
Content length
Character encoding
Headers
Body 
</code></pre>
<h3 id="可操作的相应数据"><a href="#可操作的相应数据" class="headerlink" title="可操作的相应数据"></a>可操作的相应数据</h3><pre><code>Status
Headers
Body 
</code></pre>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2016-04-19T00:00:00.000Z" title="4/19/2016, 12:00:00 AM">2016-04-19</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"> 雾非雾的情思 </span><span class="level-item">8 分钟读完 (大约1125个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2016/04/19/%E4%BD%BF%E7%94%A8nginx-clojure%E9%85%8D%E7%BD%AEnginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/">使用nginx-clojure配置nginx负载均衡</a></h1><div class="content"><h2 id="使用背景"><a href="#使用背景" class="headerlink" title="使用背景"></a>使用背景</h2><blockquote>
<p>最近遇到一个很困扰的问题，系统请求量变大了一台服务器已经扛不住了。于是我基于mq升级了我的服务，让我的服务能够支持横向扩展，通过mq服务完成各节点之间的通信。于是我们将服务部署到两个节点上，然后通过nginx随机将请求平均分发到两个节点。那么问题来了，在随机分发到两个节点之后服务器的CPU占用有所下降，但是内存占用却没有降下来。于是我们分析了一下原因，因为是随机分发，那么同一条数据请求两台服务器都会随机到，那么在这两台服务器上就会有相同的数据缓存，那么这样就会造成内存的浪费。于是我们就想办法根据请求的参数进行分发，保证同一条数据请求只会到同一台服务器。<br>开始时我们用到了consistent_hash，但是我们客户端请求不规范有有些参数是放在POST请求中的，consistent_hash是无法根据POST请求中的参数进行hash，然后分发。于是在网上搜索了很多资料，直到我找到了nginx-clojure。选nginx-clojure是因为他可以用我熟悉的语言写插件：Java。<br>安装配置</p>
</blockquote>
<h3 id="安装nginx-clojure插件"><a href="#安装nginx-clojure插件" class="headerlink" title="安装nginx-clojure插件"></a>安装nginx-clojure插件</h3><p>下载nginx和nginx-clojure源码，分别去他们的官网下载就可以，然后将他们解压、编译、安装。脚本如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=/usr/local/nginx --add-module=nginx-clojure安装模块</span><br><span class="line">make</span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<h3 id="配置nginx-clojure"><a href="#配置nginx-clojure" class="headerlink" title="配置nginx-clojure"></a>配置nginx-clojure</h3><p>在nginx.conf中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">### 建议这里查看官方文档，比较详细</span><br><span class="line">### 官方文档地址：http:&#x2F;&#x2F;nginx-clojure.github.io&#x2F;configuration.html#21-jvm-path--class-path--other-jvm-options</span><br><span class="line">jvm_path auto;</span><br><span class="line"># 这个是classpath需要用到的jar包都需要加入到classpath中。</span><br><span class="line">jvm_classpath &quot;&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;libs&#x2F;nginx-clojure-0.4.4&#x2F;jars&#x2F;*:&#x2F;Users&#x2F;gaoyoubo&#x2F;work&#x2F;dianping-service&#x2F;dianping-nginx&#x2F;target&#x2F;dianping-nginx-2.0.1-SNAPSHOT.jar&quot;;</span><br></pre></td></tr></table></figure>

<h3 id="配置自己的location"><a href="#配置自己的location" class="headerlink" title="配置自己的location"></a>配置自己的location</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">set $node &quot;&quot;;</span><br><span class="line">location &#x2F; &#123;</span><br><span class="line">    # 加上他会读取POST请求数据，不需要的时候建议关掉</span><br><span class="line">    always_read_body on;</span><br><span class="line">    # handler类型，nginx-clojure支持三种：clojure、groovy、java，这里主要讲解java</span><br><span class="line">    rewrite_handler_type &#39;java&#39;;</span><br><span class="line">    # 这里是处理类</span><br><span class="line">    rewrite_handler_name &#39;cn.mucang.dianping.nginx.DianpingRewriteHandler&#39;;</span><br><span class="line">    proxy_pass $node;</span><br><span class="line">    proxy_set_header Host $host;</span><br><span class="line">    proxy_set_header X-Real-IP   $remote_addr;</span><br><span class="line">    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="编写处理类"><a href="#编写处理类" class="headerlink" title="编写处理类"></a>编写处理类</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.mucang.dianping.nginx;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> nginx.clojure.NativeInputStream;</span><br><span class="line"><span class="keyword">import</span> nginx.clojure.NginxClojureRT;</span><br><span class="line"><span class="keyword">import</span> nginx.clojure.java.Constants;</span><br><span class="line"><span class="keyword">import</span> nginx.clojure.java.NginxJavaRequest;</span><br><span class="line"><span class="keyword">import</span> nginx.clojure.java.NginxJavaRingHandler;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.MapUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URLDecoder;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Gao Youbo</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2016-03-17 15:02</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DianpingRewriteHandler</span> <span class="keyword">implements</span> <span class="title">NginxJavaRingHandler</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_URI = <span class="string">&quot;uri&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_BODY = <span class="string">&quot;body&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_REQUEST_METHOD = <span class="string">&quot;request-method&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String KEY_QUERY_STRING = <span class="string">&quot;query-string&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String ENCODING = <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> Map NODES = <span class="keyword">new</span> HashMap();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> NODE_SIZE = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String MASTER_NODE = <span class="string">&quot;node1&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String SALVE_NODE = <span class="string">&quot;node2&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Random R = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        NODES.put(<span class="number">0</span>, MASTER_NODE);</span><br><span class="line">        NODES.put(<span class="number">1</span>, SALVE_NODE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object[] invoke(Map requestMap) <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">long</span> start = System.currentTimeMillis();</span><br><span class="line">        Map params = getParams(requestMap);   <span class="comment">// 所有的请求参数包括GET和POST</span></span><br><span class="line">        String node = getNode(requestMap);</span><br><span class="line"></span><br><span class="line">        NginxJavaRequest request = (NginxJavaRequest) requestMap;</span><br><span class="line">        request.setVariable(<span class="string">&quot;node&quot;</span>, normalizeNode(node));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">long</span> elasped = System.currentTimeMillis() - start;</span><br><span class="line">        NginxClojureRT.log.info(String.format(<span class="string">&quot;[gaoyoubo] elasped:%s ms, node=%s, uri:%s, elasped, node, uri));</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        return Constants.PHASE_DONE;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    /**</span></span><br><span class="line"><span class="string">     * 计算当前请求应该走哪个节点</span></span><br><span class="line"><span class="string">     *</span></span><br><span class="line"><span class="string">     * @param requestMap</span></span><br><span class="line"><span class="string">     * @return</span></span><br><span class="line"><span class="string">     */</span></span><br><span class="line"><span class="string">    private String getNode(Map requestMap) &#123;</span></span><br><span class="line"><span class="string">        // 业务逻辑</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    private String normalizeNode(String node) &#123;</span></span><br><span class="line"><span class="string">        return &quot;</span>http:<span class="comment">//&quot; + node;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取请求参数, 包括GET和POST</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map <span class="title">getParams</span><span class="params">(Map requestMap)</span> </span>&#123;</span><br><span class="line">        Map params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            params.putAll(getGetParams(requestMap));</span><br><span class="line">            params.putAll(getPostParams(requestMap));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            NginxClojureRT.log.error(<span class="string">&quot;获取请求参数失败&quot;</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取GET请求参数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map <span class="title">getGetParams</span><span class="params">(Map requestMap)</span> </span>&#123;</span><br><span class="line">        String queryString = MapUtils.getString(requestMap, KEY_QUERY_STRING);</span><br><span class="line">        <span class="keyword">return</span> buildQuerys(queryString);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取POST请求参数</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> requestMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map <span class="title">getPostParams</span><span class="params">(Map requestMap)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String requestMethod = MapUtils.getString(requestMap, KEY_REQUEST_METHOD);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.equalsIgnoreCase(requestMethod, <span class="string">&quot;POST&quot;</span>)) &#123; <span class="comment">// 如果是POST请求,那么处理下POST参数</span></span><br><span class="line">            Object bodyObj = requestMap.get(KEY_BODY);</span><br><span class="line">            <span class="keyword">if</span> (bodyObj != <span class="keyword">null</span>) &#123;</span><br><span class="line">                NativeInputStream nis = (NativeInputStream) bodyObj;</span><br><span class="line">                String body = IOUtils.toString(nis, ENCODING);</span><br><span class="line">                <span class="keyword">return</span> buildQuerys(body);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将字符串格式的参数转换成Map</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> queryString</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Map <span class="title">buildQuerys</span><span class="params">(String queryString)</span> </span>&#123;</span><br><span class="line">        Map params = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.isBlank(queryString)) &#123;</span><br><span class="line">            <span class="keyword">return</span> params;</span><br><span class="line">        &#125;</span><br><span class="line">        String[] kvs = queryString.split(<span class="string">&quot;&amp;&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (kvs != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String kv : kvs) &#123;</span><br><span class="line">                String[] pair = kv.split(<span class="string">&quot;\\=&quot;</span>, <span class="number">2</span>);</span><br><span class="line">                <span class="keyword">if</span> (pair.length == <span class="number">2</span>) &#123;</span><br><span class="line">                    params.put(pair[<span class="number">0</span>], urlDecode(pair[<span class="number">1</span>], ENCODING));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> params;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">urlDecode</span><span class="params">(String s, String encoding)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> URLDecoder.decode(s, encoding);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">            NginxClojureRT.log.error(<span class="keyword">null</span>, ex);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2015-03-13T23:03:11.000Z" title="3/13/2015, 11:03:11 PM">2015-03-13</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.735Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">4 分钟读完 (大约538个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/03/13/%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83%E4%B8%8BJAVA%E8%BF%9B%E7%A8%8B%E9%AB%98CPU%E5%8D%A0%E7%94%A8%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5/">生产环境下JAVA进程高CPU占用故障排查</a></h1><div class="content"><p>收藏一篇文章，这两天被驾校之家CPU占用过高的问题弄的寝食难安。马上用下面的方法监控一下。</p>
<p>参考文章：</p>
<p>    1. <a target="_blank" rel="noopener" href="http://blog.csdn.net/blade2001/article/details/9065985">http://blog.csdn.net/blade2001/article/details/9065985</a></p>
<p>    2. <a target="_blank" rel="noopener" href="http://blog.csdn.net/jiangguilong2000/article/details/17971247">http://blog.csdn.net/jiangguilong2000/article/details/17971247</a></p>
<p>问题描述：<br>生产环境下的某台tomcat7服务器，在刚发布时的时候一切都很正常，在运行一段时间后就出现CPU占用很高的问题，基本上是负载一天比一天高。  </p>
<p>问题分析：<br>1，程序属于CPU密集型，和开发沟通过，排除此类情况。<br>2，程序代码有问题，出现死循环，可能性极大。  </p>
<p>问题解决：<br>1，开发那边无法排查代码某个模块有问题，从日志上也无法分析得出。<br>2，记得原来通过strace跟踪的方法解决了一台PHP服务器CPU占用高的问题，但是通过这种方法无效，经过google搜索，发现可以通过下面的方法进行解决，那就尝试下吧。  </p>
<p>解决过程：<br>1，根据top命令，发现PID为2633的Java进程占用CPU高达300%，出现故障。  </p>
<p>2，找到该进程后，如何定位具体线程或代码呢，首先显示线程列表,并按照CPU占用高的线程排序：<br>[root@localhost logs]# ps -mp 2633 -o THREAD,tid,time | sort -rn  </p>
<p>显示结果如下：<br>USER     %CPU PRI SCNT WCHAN  USER SYSTEM   TID     TIME<br>root     10.5  19    - -         -      -  3626 00:12:48<br>root     10.1  19    - -         -      -  3593 00:12:16  </p>
<p>找到了耗时最高的线程3626，占用CPU时间有12分钟了！  </p>
<p>将需要的线程ID转换为16进制格式：<br>[root@localhost logs]# printf “%x\n” 3626<br>e18  </p>
<p>最后打印线程的堆栈信息：<br>[root@localhost logs]# jstack 2633 |grep e18 -A 30  </p>
<p>将输出的信息发给开发部进行确认，这样就能找出有问题的代码。<br>通过最近几天的监控，CPU已经安静下来了。</p>
</div></article></div><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2015-03-02T11:49:20.000Z" title="3/2/2015, 11:49:20 AM">2015-03-02</time>发表</span><span class="level-item"><time dateTime="2021-06-10T02:08:47.727Z" title="6/10/2021, 2:08:47 AM">2021-06-10</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></span><span class="level-item">7 分钟读完 (大约996个字)</span></div></div><h1 class="title is-3 is-size-4-mobile"><a class="link-muted" href="/2015/03/02/FULL-GC%E5%88%86%E6%9E%90%E8%BF%87%E7%A8%8B%E5%88%86%E4%BA%AB/">FULL GC分析过程分享</a></h1><div class="content"><p>转载-原文地址：<a target="_blank" rel="noopener" href="http://www.taobaotest.com/blogs/2294">http://www.taobaotest.com/blogs/2294</a></p>
<p>在性能测试过程中,FULL GC频繁是比较常见的问题，FULL GC 产生的原因有很多，这里主要针对meta压测过程中分析FULL GC问题的一些思路进行分享，供大家参考</p>
<p>1.如何发现是否发生FULL GC和FULL GC是否频繁</p>
<p>使用JDK自带的轻量级小工具jstat</p>
<p>     语法结构：</p>
<p>Usage: jstat -help|-options</p>
<p>             jstat -<option> [-t] [-h<lines>] <vmid> [<interval> [<count>]]</p>
<p> 参数解释：</p>
<p>Options — 选项，我们一般使用 -gcutil 查看gc情况</p>
<p>vmid    — VM的进程号，即当前运行的java进程号</p>
<p>interval– 间隔时间，单位为秒或者毫秒</p>
<p>count   — 打印次数，如果缺省则打印无数次</p>
<p>比如 /opt/taobao/java/bin/jstat –gcutil pid 5000</p>
<p> </p>
<p>输出结果：</p>
<p>        S0        S1         E          O          P        YGC      YGCT        FGC     FGCT        GCT</p>
<p>           0.00  90.63 100.00  58.82   3.51    183    2.059     0    0.000    2.059</p>
<p>    0.00  15.48   7.80  60.99   3.51    185    2.092     1    0.305    2.397</p>
<p>    0.00  15.48  18.10  47.90   3.51    185    2.092     2    0.348    2.440</p>
<p> S0  — Heap上的 Survivor space 0 区已使用空间的百分比<br> S1  — Heap上的 Survivor space 1 区已使用空间的百分比<br> E   — Heap上的 Eden space 区已使用空间的百分比<br> O   — Heap上的 Old space 区已使用空间的百分比<br> P   — Perm space 区已使用空间的百分比<br> YGC — 从应用程序启动到采样时发生 Young GC 的次数<br> YGCT– 从应用程序启动到采样时 Young GC 所用的时间(单位秒)<br> FGC — 从应用程序启动到采样时发生 Full GC 的次数<br> FGCT– 从应用程序启动到采样时 Full GC 所用的时间(单位秒)<br> GCT — 从应用程序启动到采样时用于垃圾回收的总时间(单位秒)</p>
<p>    通过FGC我们可以发现系统是否发生FULL GC和FULL GC的频率</p>
<p>2.  FULL GC分析和问题定位</p>
<p>    a.     GC log收集和分析</p>
<p>(1)在JVM启动参数增加：”-verbose:gc -Xloggc:&lt;file_name&gt;  -XX:+PrintGCDetails -XX:+PrintGCDateStamps”</p>
<p>    PrintGCTimeStamp只能获得相对时间，建议使用PrintGCDateStamps获得full gc 发生的绝对时间</p>
<p>      (2)如果采用CMS GC,仔细分析jstat FGC输出和GC 日志会发现， CMS的每个并发GC周期则有两个stop-the-world阶段——initial mark与final re-mark<strong>，</strong>使得CMS的每个并发GC周期总共会更新full GC计数器两次，initial mark与final re-mark各一次</p>
<p>    </p>
<p>    b.     Dump JVM 内存快照</p>
<p>/opt/taobao/java/bin/jmap -dump:format=b,file=dump.bin pid</p>
<p>这里有一个问题是什么时候进行dump?</p>
<p>一种方法是前面提到的用jstat工具观察，当OLD区到达比较高的比例如60%，一般会很快触发一次FULL GC,可以进行一次DUMP,在FULL GC发生以后再DUMP一次，这样比较就可以发现到底是哪些对象导致不停的FULL GC</p>
<p>另外一种方法是通过配置JVM参数</p>
<p> -XX:+HeapDumpBeforeFullGC -XX:+HeapDumpAfterFullGC分别用于指定在full GC之前与之后生成heap dump </p>
<p>    c.     利用MAT((Memory Analyzer Tool)工具分析dump文件</p>
<p>关于MAT具体使用方法网上有很多介绍，这里不做详细展开，这里需要注意的是：</p>
<p>(1)   MAT缺省只分析reachable的对象，unreachable的对象（将被收集掉的对象）被忽略，而分析FULL GC频繁原因时unreachable object也应该同时被重点关注。如果要显示unreachable的对象细节必须用mat 1.1以上版本并且打开选项“keep unreachable object”</p>
<p>(2)   通常dump文件会好几个G，无法在windows上直接进行分析，我们可以先把dump文件在linux上进行分析，再把分析好的文件拷贝到windows上，在windows上用MAT打开分析文件。</p>
<p>下面是Meta2.0压测曾遇到的FULL GC频繁问题的分析结果，比较明显，DispatchRequest对象有4千多万个，一共超过2G，并最终导致OOM</p>
<p><img src="http://file.mspring.org/images/blog/83f48d2a9de38682ed93018f08211d9e!detail" alt="83f48d2a9de38682ed93018f08211d9e_detail"></p>
</div></article></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="http://file.mspring.org/images/blog/avatar.jpg" alt="雾非雾的情思"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">雾非雾的情思</p><p class="is-size-6 is-block">爱折腾的老码农！</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Wuhan, China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">150</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">29</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/gaoyoubo" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/gaoyoubo"><i class="fab fa-github"></i></a></div></div></div><!--!--><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"><span class="level-start"><span class="level-item">碎碎念</span></span><span class="level-end"><span class="level-item tag">39</span></span></a></li><li><a class="level is-mobile" href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/"><span class="level-start"><span class="level-item">程序员</span></span><span class="level-end"><span class="level-item tag">86</span></span></a></li></ul></div></div></div><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-06-10T10:08:18.000Z">2021-06-10</time></p><p class="title"><a href="/2021/06/10/%E6%89%B9%E9%87%8F%E6%8B%89%E5%8F%96%E4%BB%A3%E7%A0%81/">批量拉取代码</a></p><p class="categories"><a href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-03-22T14:04:19.000Z">2021-03-22</time></p><p class="title"><a href="/2021/03/22/MacOS%E5%AE%89%E8%A3%85PHP/">MacOS安装PHP</a></p><p class="categories"><a href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-22T22:13:31.000Z">2021-01-22</time></p><p class="title"><a href="/2021/01/22/%E7%BE%A4%E8%BE%89QNAP%E4%BD%BF%E7%94%A8%E5%A4%87%E5%BF%98/">群辉QNAP使用备忘</a></p><p class="categories"><a href="/categories/%E7%A2%8E%E7%A2%8E%E5%BF%B5/">碎碎念</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2021-01-19T16:53:42.000Z">2021-01-19</time></p><p class="title"><a href="/2021/01/19/mac-iterm2-rz%E4%B8%8Esz%E7%9A%84%E5%8A%9F%E8%83%BD/">mac iterm2 rz与sz的功能</a></p><p class="categories"><a href="/categories/%E7%A8%8B%E5%BA%8F%E5%91%98/">程序员</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2020-11-25T11:18:00.000Z">2020-11-25</time></p><p class="title"><a href="/2020/11/25/Mac%E4%BD%BF%E7%94%A8%E8%BF%87%E7%A8%8B%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/">Mac使用过程中的问题汇总</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2021/06/"><span class="level-start"><span class="level-item">六月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/03/"><span class="level-start"><span class="level-item">三月 2021</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2021/01/"><span class="level-start"><span class="level-item">一月 2021</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/11/"><span class="level-start"><span class="level-item">十一月 2020</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/10/"><span class="level-start"><span class="level-item">十月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/06/"><span class="level-start"><span class="level-item">六月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2020/03/"><span class="level-start"><span class="level-item">三月 2020</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/12/"><span class="level-start"><span class="level-item">十二月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/11/"><span class="level-start"><span class="level-item">十一月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/10/"><span class="level-start"><span class="level-item">十月 2019</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/09/"><span class="level-start"><span class="level-item">九月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/08/"><span class="level-start"><span class="level-item">八月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/07/"><span class="level-start"><span class="level-item">七月 2019</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/06/"><span class="level-start"><span class="level-item">六月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/05/"><span class="level-start"><span class="level-item">五月 2019</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/04/"><span class="level-start"><span class="level-item">四月 2019</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/03/"><span class="level-start"><span class="level-item">三月 2019</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/02/"><span class="level-start"><span class="level-item">二月 2019</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2019/01/"><span class="level-start"><span class="level-item">一月 2019</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/12/"><span class="level-start"><span class="level-item">十二月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/11/"><span class="level-start"><span class="level-item">十一月 2018</span></span><span class="level-end"><span class="level-item tag">9</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/10/"><span class="level-start"><span class="level-item">十月 2018</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/09/"><span class="level-start"><span class="level-item">九月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/08/"><span class="level-start"><span class="level-item">八月 2018</span></span><span class="level-end"><span class="level-item tag">8</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/06/"><span class="level-start"><span class="level-item">六月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/05/"><span class="level-start"><span class="level-item">五月 2018</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/04/"><span class="level-start"><span class="level-item">四月 2018</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/03/"><span class="level-start"><span class="level-item">三月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/02/"><span class="level-start"><span class="level-item">二月 2018</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2018/01/"><span class="level-start"><span class="level-item">一月 2018</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/12/"><span class="level-start"><span class="level-item">十二月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/11/"><span class="level-start"><span class="level-item">十一月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/09/"><span class="level-start"><span class="level-item">九月 2017</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/07/"><span class="level-start"><span class="level-item">七月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/06/"><span class="level-start"><span class="level-item">六月 2017</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/04/"><span class="level-start"><span class="level-item">四月 2017</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2017/03/"><span class="level-start"><span class="level-item">三月 2017</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/11/"><span class="level-start"><span class="level-item">十一月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/04/"><span class="level-start"><span class="level-item">四月 2016</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/03/"><span class="level-start"><span class="level-item">三月 2016</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2016/02/"><span class="level-start"><span class="level-item">二月 2016</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/07/"><span class="level-start"><span class="level-item">七月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/05/"><span class="level-start"><span class="level-item">五月 2015</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/04/"><span class="level-start"><span class="level-item">四月 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/03/"><span class="level-start"><span class="level-item">三月 2015</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/archives/2015/02/"><span class="level-start"><span class="level-item">二月 2015</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/10/"><span class="level-start"><span class="level-item">十月 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/08/"><span class="level-start"><span class="level-item">八月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/06/"><span class="level-start"><span class="level-item">六月 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/05/"><span class="level-start"><span class="level-item">五月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/03/"><span class="level-start"><span class="level-item">三月 2014</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2014/01/"><span class="level-start"><span class="level-item">一月 2014</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/12/"><span class="level-start"><span class="level-item">十二月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/10/"><span class="level-start"><span class="level-item">十月 2013</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/archives/2013/09/"><span class="level-start"><span class="level-item">九月 2013</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Android/"><span class="tag">Android</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ElasticSearch/"><span class="tag">ElasticSearch</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Electron/"><span class="tag">Electron</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Go/"><span class="tag">Go</span><span class="tag">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hadoop/"><span class="tag">Hadoop</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Hexo/"><span class="tag">Hexo</span><span class="tag">10</span></a></div><div class="control"><a class="tags has-addons" href="/tags/HexoClient/"><span class="tag">HexoClient</span><span class="tag">17</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">18</span></a></div><div class="control"><a class="tags has-addons" href="/tags/JavaCV/"><span class="tag">JavaCV</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Nginx/"><span class="tag">Nginx</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ffmpeg/"><span class="tag">ffmpeg</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/git/"><span class="tag">git</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/js/"><span class="tag">js</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mac/"><span class="tag">mac</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mariadb/"><span class="tag">mariadb</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/markdown/"><span class="tag">markdown</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/mysql/"><span class="tag">mysql</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ocr/"><span class="tag">ocr</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/php/"><span class="tag">php</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/python/"><span class="tag">python</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/shadowsocks/"><span class="tag">shadowsocks</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/springboot/"><span class="tag">springboot</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tesseract/"><span class="tag">tesseract</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F/"><span class="tag">推荐系统</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A2%8E%E7%A2%8E%E5%BF%B5/"><span class="tag">碎碎念</span><span class="tag">38</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%A8%8B%E5%BA%8F%E5%91%98/"><span class="tag">程序员</span><span class="tag">44</span></a></div></div></div></div></div></div><!--!--></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="http://file.mspring.org/images/blog/avatar.jpg" alt="雾非雾的情思" height="28"></a><p class="is-size-7"><span>&copy; 2021 雾非雾的情思</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Github" href="https://github.com/gaoyoubo"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>